<!DOCTYPE html>
<!-- saved from url=(0060)file:///Users/sun/Downloads/spiritual-survey-prof%20(2).html -->
<html lang="zh-TW"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>éˆæ€§ä¿®é¤Šå•å·ç”Ÿæˆèˆ‡åˆ†æç³»çµ± </title>
    <style>
        /* é‡ç½®å’ŒåŸºç¤æ¨£å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* è¼‰å…¥ç‹€æ…‹ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* é é¢åˆ‡æ› */
        .page {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .page.active {
            display: block;
            opacity: 1;
        }

        /* å°èˆªæ¬„ */
        .navbar {
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 0;
            margin-bottom: 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2563eb;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #4b5563;
        }

        .btn-success {
            background: #059669;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #047857;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #b91c1c;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        .btn-icon {
            padding: 0.5rem;
            background: transparent;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover:not(:disabled) {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        /* ç·¨è¼¯é é¢ä½ˆå±€ */
        .editor-layout {
            display: grid;
            grid-template-columns: 300px 1fr 400px;
            gap: 2rem;
            height: calc(100vh - 200px);
        }

        .editor-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }

        .panel-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0;
        }

        .panel-content {
            padding: 1.5rem;
            height: calc(100% - 80px);
            overflow-y: auto;
        }

        /* åˆ†é¡æ¨¹ */
        .category-layer {
            margin-bottom: 2rem;
        }

        .category-layer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .category-layer-header h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin: 0;
        }

        .category-node {
            margin-bottom: 0.5rem;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
        }

        .category-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .category-name {
            font-weight: 500;
            flex: 1;
        }

        .question-count {
            background: #dbeafe;
            color: #1e40af;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-right: 0.5rem;
            min-width: 24px;
            text-align: center;
        }

        .category-actions {
            display: flex;
            gap: 0.25rem;
        }

        .category-children {
            margin-left: 1rem;
            margin-top: 0.5rem;
        }

        /* é¡Œç›®åˆ—è¡¨ */
        .question-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-input.error {
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            background: white;
            cursor: pointer;
        }

        .question-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: move;
            transition: all 0.2s;
        }

        .question-item:hover {
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-color: #d1d5db;
        }

        .question-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .question-content {
            flex: 1;
        }

        .question-text {
            font-weight: 500;
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }

        .question-meta {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            font-size: 0.75rem;
            color: #6b7280;
            flex-wrap: wrap;
        }

        .question-categories {
            background: #f3f4f6;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .religious-tag {
            background: #fef3c7;
            color: #92400e;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .question-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-top: 0.5rem;
        }

        .drag-handle {
            cursor: grab;
            color: #9ca3af;
            font-weight: bold;
            padding: 0.25rem;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        /* é è¦½é¢æ¿ */
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .preview-info {
            display: flex;
            gap: 1rem;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .preview-intro {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .preview-question {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .question-number {
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 0.5rem;
        }

        .scale-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .scale-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .scale-option:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .scale-option input[type="radio"] {
            margin: 0;
        }

        .scale-label {
            font-size: 0.875rem;
        }

        /* æ¨¡æ…‹æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* è¡¨å–®æ¨£å¼ */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox-label:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .checkbox-label input[type="checkbox"] {
            margin: 0;
        }

        /* åˆ†é¡çµ„ */
        .category-group {
            margin-bottom: 1.5rem;
        }

        .category-group h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }

        /* ä½œç­”é é¢ */
        .survey-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .survey-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .survey-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .survey-subtitle {
            font-size: 1.125rem;
            opacity: 0.9;
        }

        .survey-content {
            padding: 2rem;
        }

        .survey-intro {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-radius: 0 8px 8px 0;
        }

        .survey-question {
            background: #fafafa;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.2s;
        }

        .survey-question:hover {
            border-color: #d1d5db;
        }

        .survey-question-number {
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 0.75rem;
            font-size: 1.125rem;
        }

        .survey-question-text {
            font-size: 1rem;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .survey-scale {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
        }

        .survey-scale-option {
            text-align: center;
            padding: 0.75rem 0.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .survey-scale-option:hover {
            border-color: #2563eb;
            background: #eff6ff;
            transform: translateY(-1px);
        }

        .survey-scale-option.selected {
            border-color: #2563eb;
            background: #2563eb;
            color: white;
            transform: translateY(-1px);
        }

        .survey-scale-value {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .survey-scale-label {
            font-size: 0.75rem;
            line-height: 1.2;
        }

        /* å€‹äººè³‡æ–™è¡¨å–® */
        .demographics-form {
            background: #f9fafb;
            border-radius: 8px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid #e5e7eb;
        }

        .demographics-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #374151;
        }

        /* çµæœåˆ†æ */
        .results-container {
            margin-top: 2rem;
            padding: 2rem;
            background: #f9fafb;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-title {
            font-size: 2rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .results-subtitle {
            color: #6b7280;
            font-size: 1.125rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .result-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }

        .result-card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #374151;
        }

        .dimension-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: #f3f4f6;
            border-radius: 6px;
        }

        .dimension-name {
            font-weight: 500;
        }

        .dimension-value {
            font-weight: bold;
            color: #2563eb;
        }

        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }

        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-align: center;
        }

        .chart-canvas {
            width: 100%;
            height: 300px;
        }

        /* å»ºè­°å€å¡Š */
        .suggestions {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }

        .suggestions-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #374151;
        }

        .suggestion-item {
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 6px;
            border-left: 4px solid #2563eb;
        }

        .suggestion-dimension {
            font-weight: 600;
            color: #2563eb;
            margin-bottom: 0.5rem;
        }

        .suggestion-text {
            line-height: 1.6;
            color: #4b5563;
        }

        /* Toast é€šçŸ¥ */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: #059669;
        }

        .toast.error {
            background: #dc2626;
        }

        .toast.warning {
            background: #d97706;
        }

        .toast.info {
            background: #2563eb;
        }

        /* çµ±è¨ˆè³‡è¨Š */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2563eb;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        /* ç‰ˆæœ¬åˆ—è¡¨ */
        .version-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: all 0.2s;
        }

        .version-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .version-info {
            flex: 1;
        }

        .version-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .version-date {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .version-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* é€²åº¦æ¢ */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2563eb, #3b82f6);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        /* éš±è—é¡ */
        .hidden {
            display: none !important;
        }

        /* éŒ¯èª¤ç‹€æ…‹ */
        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .success-message {
            color: #059669;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* ç©ºç‹€æ…‹ */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px dashed #d1d5db;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 1200px) {
            .editor-layout {
                grid-template-columns: 250px 1fr 350px;
            }
        }

        @media (max-width: 768px) {
            .editor-layout {
                grid-template-columns: 1fr;
                height: auto;
            }

            .editor-panel {
                height: 400px;
            }

            .nav-content {
                flex-direction: column;
                gap: 1rem;
            }

            .question-controls {
                flex-direction: column;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .survey-scale {
                grid-template-columns: repeat(3, 1fr);
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            .survey-content {
                padding: 1rem;
            }

            .survey-scale {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* å‹•ç•«æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        .slide-in {
            animation: slideIn 0.3s ease;
        }

        /* å·¥å…·æç¤º */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- è¼‰å…¥è¦†è“‹å±¤ -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- å°èˆªæ¬„ -->
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-title">éˆæ€§ä¿®é¤Šå•å·ç³»çµ± - å°ˆæ¥­ç‰ˆ</div>
            <div class="nav-buttons">
                <button class="btn btn-primary" data-action="show-page" data-page="editor">å•å·ç·¨è¼¯</button>
                <button class="btn btn-secondary" data-action="show-page" data-page="survey">å•å·ä½œç­”</button>
            </div>
        </div>
    </nav>

    <!-- ç·¨è¼¯é é¢ -->
    <div id="editor-page" class="page active">
        <div class="container">
            <!-- çµ±è¨ˆè³‡è¨Š -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stats-categories">33</div>
                    <div class="stat-label">åˆ†é¡æ•¸é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stats-questions">15</div>
                    <div class="stat-label">é¡Œç›®æ•¸é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stats-versions">2</div>
                    <div class="stat-label">ç‰ˆæœ¬æ•¸é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stats-responses">0</div>
                    <div class="stat-label">å›è¦†æ•¸é‡</div>
                </div>
            </div>

            <!-- ç·¨è¼¯å™¨ä½ˆå±€ -->
            <div class="editor-layout">
                <!-- å·¦å´ï¼šåˆ†é¡æ¨¹ -->
                <div class="editor-panel">
                    <div class="panel-header">
                        <div class="panel-title">åˆ†é¡ç®¡ç†</div>
                        <button class="btn btn-small btn-primary" data-action="add-category">æ–°å¢åˆ†é¡</button>
                    </div>
                    <div class="panel-content">
                        <div id="category-tree">
                        <div class="category-layer fade-in">
                            <div class="category-layer-header">
                                <h3>éˆæ€§ä¿®é¤Šä¸ƒé¢å‘</h3>
                                <button class="btn-icon tooltip" data-action="add-category" data-layer="FACETS_7" data-tooltip="æ–°å¢åˆ†é¡">
                                    <span>+</span>
                                </button>
                            </div>
                            <div class="category-layer-content">
                                
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">èµ·å¿ƒå‹•å¿µ</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="facet-1" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="facet-1" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">å¾Œè¨­æ€è€ƒ</span>
                                <span class="question-count">2</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="facet-2" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="facet-2" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">æ„ç¾©è¿½å°‹</span>
                                <span class="question-count">2</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="facet-3" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="facet-3" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">äººéš›éˆä¿®</span>
                                <span class="question-count">4</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="facet-4" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="facet-4" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">ç‰©è³ªèˆ‡ç’°å¢ƒ</span>
                                <span class="question-count">2</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="facet-5" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="facet-5" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">èˆ‡è¶…è¶Šè€…çš„é€£çµ</span>
                                <span class="question-count">2</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="facet-6" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="facet-6" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">ç”Ÿæ´»å½¢æ…‹èˆ‡å…¨äººå¥åº·</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="facet-7" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="facet-7" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                            </div>
                        </div>
                    
                        <div class="category-layer fade-in">
                            <div class="category-layer-header">
                                <h3>éˆæ€§å¥åº·åæ ¸å¿ƒæŒ‡æ¨™</h3>
                                <button class="btn-icon tooltip" data-action="add-category" data-layer="INDICATORS_10" data-tooltip="æ–°å¢åˆ†é¡">
                                    <span>+</span>
                                </button>
                            </div>
                            <div class="category-layer-content">
                                
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">äººæ ¼çµ±æ•´</span>
                                <span class="question-count">2</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="indicator-1" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="indicator-1" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">è¿½æ±‚çœŸç†çš„å¾Œè¨­åæ€</span>
                                <span class="question-count">2</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="indicator-2" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="indicator-2" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">æ„ç¾©èˆ‡ç›®çš„</span>
                                <span class="question-count">2</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="indicator-3" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="indicator-3" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">æ„›èˆ‡åŒç†</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="indicator-4" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="indicator-4" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">å¯¬æ•èˆ‡å’Œè§£</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="indicator-5" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="indicator-5" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">æ„Ÿæ©èˆ‡å–œæ¨‚</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="indicator-6" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="indicator-6" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">è²¡ç‰©å€«ç†èˆ‡éˆä¿®</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="indicator-7" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="indicator-7" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">æƒœç‰©èˆ‡å…±ç”Ÿ</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="indicator-8" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="indicator-8" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">ä¿¡ä»°èˆ‡é€£çµ</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="indicator-9" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="indicator-9" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">å®—æ•™ä¿¡ä»°èˆ‡éˆæ€§ä¿®é¤Š</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="indicator-10" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="indicator-10" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                            </div>
                        </div>
                    
                        <div class="category-layer fade-in">
                            <div class="category-layer-header">
                                <h3>éˆä¿®ä¸ƒåŸå‰‡</h3>
                                <button class="btn-icon tooltip" data-action="add-category" data-layer="PRINCIPLES_7" data-tooltip="æ–°å¢åˆ†é¡">
                                    <span>+</span>
                                </button>
                            </div>
                            <div class="category-layer-content">
                                
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">åœ¨æ¯ä¸€å€‹äººèº«ä¸Šçœ‹è¦‹ç¥ã€çœ‹è¦‹ä½›ã€çœ‹è¦‹äºº</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="principle-1" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="principle-1" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">ç¬¬ä¸€å€‹å»æ„›ã€ç¬¬ä¸€å€‹å»çµ¦</span>
                                <span class="question-count">2</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="principle-2" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="principle-2" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">çµ¦äººä¿¡å¿ƒã€çµ¦äººå¸Œæœ›ã€çµ¦äººæ­¡å–œã€çµ¦äººæ–¹ä¾¿</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="principle-3" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="principle-3" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">ç·©æ–¼ç™¼æ€’ã€æ•æ–¼å¯¬æ•ã€å‹‡æ–¼é“æ­‰ã€æ™‚æ™‚æ„Ÿæ©</span>
                                <span class="question-count">3</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="principle-4" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="principle-4" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">é€£çµç¥è–ã€è¿½æ±‚æ„ç¾©ã€æ“‡å–„å›ºåŸ·ã€ä¸è®Šéš¨ç·£</span>
                                <span class="question-count">1</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="principle-5" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="principle-5" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">å½¹ç‰©ä¸å½¹æ–¼ç‰©ï¼Œæƒœç‰©åšç”Ÿæ¿Ÿä¸–</span>
                                <span class="question-count">2</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="principle-6" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="principle-6" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">èª æ„æ­£å¿ƒã€æˆ’æ…ææ‡¼ã€å¾Œè¨­åæ€ã€é–‹æ”¾å…¬æ­£</span>
                                <span class="question-count">2</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="principle-7" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="principle-7" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                            </div>
                        </div>
                    
                        <div class="category-layer fade-in">
                            <div class="category-layer-header">
                                <h3>æ—¥å¸¸éˆä¿®å¯¦è¸</h3>
                                <button class="btn-icon tooltip" data-action="add-category" data-layer="PRACTICES" data-tooltip="æ–°å¢åˆ†é¡">
                                    <span>+</span>
                                </button>
                            </div>
                            <div class="category-layer-content">
                                
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- ä¸­é–“ï¼šé¡Œç›®ç®¡ç† -->
                <div class="editor-panel">
                    <div class="panel-header">
                        <div class="panel-title">é¡Œç›®ç®¡ç†</div>
                        <button class="btn btn-small btn-primary" data-action="add-question">æ–°å¢é¡Œç›®</button>
                    </div>
                    <div class="panel-content">
                        <!-- æœå°‹å’Œç¯©é¸ -->
                        <div class="question-controls">
                            <div class="form-group">
                                <input type="text" id="question-search" class="form-input" placeholder="æœå°‹é¡Œç›®...">
                            </div>
                            <div class="form-group">
                                <select id="category-filter" class="form-select"><option value="">æ‰€æœ‰åˆ†é¡</option><optgroup label="éˆæ€§ä¿®é¤Šä¸ƒé¢å‘"><option value="facet-1">èµ·å¿ƒå‹•å¿µ</option><option value="facet-2">å¾Œè¨­æ€è€ƒ</option><option value="facet-3">æ„ç¾©è¿½å°‹</option><option value="facet-4">äººéš›éˆä¿®</option><option value="facet-5">ç‰©è³ªèˆ‡ç’°å¢ƒ</option><option value="facet-6">èˆ‡è¶…è¶Šè€…çš„é€£çµ</option><option value="facet-7">ç”Ÿæ´»å½¢æ…‹èˆ‡å…¨äººå¥åº·</option></optgroup><optgroup label="éˆæ€§å¥åº·åæ ¸å¿ƒæŒ‡æ¨™"><option value="indicator-1">äººæ ¼çµ±æ•´</option><option value="indicator-2">è¿½æ±‚çœŸç†çš„å¾Œè¨­åæ€</option><option value="indicator-3">æ„ç¾©èˆ‡ç›®çš„</option><option value="indicator-4">æ„›èˆ‡åŒç†</option><option value="indicator-5">å¯¬æ•èˆ‡å’Œè§£</option><option value="indicator-6">æ„Ÿæ©èˆ‡å–œæ¨‚</option><option value="indicator-7">è²¡ç‰©å€«ç†èˆ‡éˆä¿®</option><option value="indicator-8">æƒœç‰©èˆ‡å…±ç”Ÿ</option><option value="indicator-9">ä¿¡ä»°èˆ‡é€£çµ</option><option value="indicator-10">å®—æ•™ä¿¡ä»°èˆ‡éˆæ€§ä¿®é¤Š</option></optgroup><optgroup label="éˆä¿®ä¸ƒåŸå‰‡"><option value="principle-1">åœ¨æ¯ä¸€å€‹äººèº«ä¸Šçœ‹è¦‹ç¥ã€çœ‹è¦‹ä½›ã€çœ‹è¦‹äºº</option><option value="principle-2">ç¬¬ä¸€å€‹å»æ„›ã€ç¬¬ä¸€å€‹å»çµ¦</option><option value="principle-3">çµ¦äººä¿¡å¿ƒã€çµ¦äººå¸Œæœ›ã€çµ¦äººæ­¡å–œã€çµ¦äººæ–¹ä¾¿</option><option value="principle-4">ç·©æ–¼ç™¼æ€’ã€æ•æ–¼å¯¬æ•ã€å‹‡æ–¼é“æ­‰ã€æ™‚æ™‚æ„Ÿæ©</option><option value="principle-5">é€£çµç¥è–ã€è¿½æ±‚æ„ç¾©ã€æ“‡å–„å›ºåŸ·ã€ä¸è®Šéš¨ç·£</option><option value="principle-6">å½¹ç‰©ä¸å½¹æ–¼ç‰©ï¼Œæƒœç‰©åšç”Ÿæ¿Ÿä¸–</option><option value="principle-7">èª æ„æ­£å¿ƒã€æˆ’æ…ææ‡¼ã€å¾Œè¨­åæ€ã€é–‹æ”¾å…¬æ­£</option></optgroup></select>
                            </div>
                            <div class="form-group">
                                <select id="religious-filter" class="form-select">
                                    <option value="">æ‰€æœ‰é¡Œç›®</option>
                                    <option value="religious">å®—æ•™æ€§</option>
                                    <option value="non-religious">éå®—æ•™æ€§</option>
                                </select>
                            </div>
                        </div>

                        <!-- é¡Œç›®åˆ—è¡¨ -->
                        <div id="question-list">
                        <div class="question-item fade-in" draggable="true" data-question-id="q-001">
                            <div class="question-content">
                                <div class="question-text">æˆ‘èƒ½å¤ è¦ºå¯Ÿè‡ªå·±å…§å¿ƒçš„æƒ³æ³•å’Œå‹•æ©Ÿ</div>
                                <div class="question-meta">
                                    <span class="question-categories">èµ·å¿ƒå‹•å¿µ, äººæ ¼çµ±æ•´</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-001" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-001" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-002">
                            <div class="question-content">
                                <div class="question-text">æˆ‘æœƒåæ€è‡ªå·±çš„è¡Œç‚ºæ˜¯å¦ç¬¦åˆå…§å¿ƒçš„åƒ¹å€¼è§€</div>
                                <div class="question-meta">
                                    <span class="question-categories">å¾Œè¨­æ€è€ƒ, è¿½æ±‚çœŸç†çš„å¾Œè¨­åæ€, èª æ„æ­£å¿ƒã€æˆ’æ…ææ‡¼ã€å¾Œè¨­åæ€ã€é–‹æ”¾å…¬æ­£</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-002" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-002" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-003">
                            <div class="question-content">
                                <div class="question-text">æˆ‘æ¸…æ¥šçŸ¥é“è‡ªå·±äººç”Ÿçš„ç›®æ¨™å’Œæ„ç¾©</div>
                                <div class="question-meta">
                                    <span class="question-categories">æ„ç¾©è¿½å°‹, æ„ç¾©èˆ‡ç›®çš„</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-003" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-003" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-004">
                            <div class="question-content">
                                <div class="question-text">æˆ‘èƒ½å¤ çœŸèª åœ°é—œæ„›ä»–äºº</div>
                                <div class="question-meta">
                                    <span class="question-categories">äººéš›éˆä¿®, æ„›èˆ‡åŒç†, åœ¨æ¯ä¸€å€‹äººèº«ä¸Šçœ‹è¦‹ç¥ã€çœ‹è¦‹ä½›ã€çœ‹è¦‹äºº, ç¬¬ä¸€å€‹å»æ„›ã€ç¬¬ä¸€å€‹å»çµ¦</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-004" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-004" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-005">
                            <div class="question-content">
                                <div class="question-text">æˆ‘æœƒåŸè«’æ›¾ç¶“å‚·å®³éæˆ‘çš„äºº</div>
                                <div class="question-meta">
                                    <span class="question-categories">äººéš›éˆä¿®, å¯¬æ•èˆ‡å’Œè§£, ç·©æ–¼ç™¼æ€’ã€æ•æ–¼å¯¬æ•ã€å‹‡æ–¼é“æ­‰ã€æ™‚æ™‚æ„Ÿæ©</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-005" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-005" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-006">
                            <div class="question-content">
                                <div class="question-text">æˆ‘å°ç”Ÿæ´»ä¸­çš„ç¾å¥½äº‹ç‰©å¿ƒå­˜æ„Ÿæ¿€</div>
                                <div class="question-meta">
                                    <span class="question-categories">æ„Ÿæ©èˆ‡å–œæ¨‚, ç·©æ–¼ç™¼æ€’ã€æ•æ–¼å¯¬æ•ã€å‹‡æ–¼é“æ­‰ã€æ™‚æ™‚æ„Ÿæ©</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-006" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-006" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-007">
                            <div class="question-content">
                                <div class="question-text">æˆ‘æœƒåˆç†ä½¿ç”¨é‡‘éŒ¢å’Œç‰©è³ªè³‡æº</div>
                                <div class="question-meta">
                                    <span class="question-categories">ç‰©è³ªèˆ‡ç’°å¢ƒ, è²¡ç‰©å€«ç†èˆ‡éˆä¿®, å½¹ç‰©ä¸å½¹æ–¼ç‰©ï¼Œæƒœç‰©åšç”Ÿæ¿Ÿä¸–</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-007" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-007" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-008">
                            <div class="question-content">
                                <div class="question-text">æˆ‘é—œå¿ƒç’°å¢ƒä¿è­·å’Œæ°¸çºŒç™¼å±•</div>
                                <div class="question-meta">
                                    <span class="question-categories">ç‰©è³ªèˆ‡ç’°å¢ƒ, æƒœç‰©èˆ‡å…±ç”Ÿ, å½¹ç‰©ä¸å½¹æ–¼ç‰©ï¼Œæƒœç‰©åšç”Ÿæ¿Ÿä¸–</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-008" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-008" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-009">
                            <div class="question-content">
                                <div class="question-text">æˆ‘æœƒä¸»å‹•å¹«åŠ©éœ€è¦å”åŠ©çš„äºº</div>
                                <div class="question-meta">
                                    <span class="question-categories">äººéš›éˆä¿®, ç¬¬ä¸€å€‹å»æ„›ã€ç¬¬ä¸€å€‹å»çµ¦, çµ¦äººä¿¡å¿ƒã€çµ¦äººå¸Œæœ›ã€çµ¦äººæ­¡å–œã€çµ¦äººæ–¹ä¾¿</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-009" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-009" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-010">
                            <div class="question-content">
                                <div class="question-text">æˆ‘èƒ½å¤ ä¿æŒå…§å¿ƒçš„å¹³éœå’Œå®‰å®š</div>
                                <div class="question-meta">
                                    <span class="question-categories">ç”Ÿæ´»å½¢æ…‹èˆ‡å…¨äººå¥åº·, äººæ ¼çµ±æ•´</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-010" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-010" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-011">
                            <div class="question-content">
                                <div class="question-text">æˆ‘æœƒé€éç¥ˆç¦±æˆ–å†¥æƒ³èˆ‡ç¥è–åŠ›é‡é€£çµ</div>
                                <div class="question-meta">
                                    <span class="question-categories">èˆ‡è¶…è¶Šè€…çš„é€£çµ, ä¿¡ä»°èˆ‡é€£çµ</span>
                                    <span class="religious-tag">å®—æ•™æ€§</span>
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-011" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-011" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-012">
                            <div class="question-content">
                                <div class="question-text">æˆ‘çš„å®—æ•™ä¿¡ä»°ç‚ºæˆ‘çš„ç”Ÿæ´»å¸¶ä¾†æŒ‡å¼•</div>
                                <div class="question-meta">
                                    <span class="question-categories">èˆ‡è¶…è¶Šè€…çš„é€£çµ, å®—æ•™ä¿¡ä»°èˆ‡éˆæ€§ä¿®é¤Š</span>
                                    <span class="religious-tag">å®—æ•™æ€§</span>
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-012" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-012" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-013">
                            <div class="question-content">
                                <div class="question-text">æˆ‘æœƒå®šæœŸé€²è¡Œè‡ªæˆ‘åçœ</div>
                                <div class="question-meta">
                                    <span class="question-categories">å¾Œè¨­æ€è€ƒ, è¿½æ±‚çœŸç†çš„å¾Œè¨­åæ€, èª æ„æ­£å¿ƒã€æˆ’æ…ææ‡¼ã€å¾Œè¨­åæ€ã€é–‹æ”¾å…¬æ­£</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-013" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-013" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-014">
                            <div class="question-content">
                                <div class="question-text">æˆ‘èƒ½å¤ åœ¨å›°é›£ä¸­æ‰¾åˆ°æˆé•·çš„æ©Ÿæœƒ</div>
                                <div class="question-meta">
                                    <span class="question-categories">æ„ç¾©è¿½å°‹, æ„ç¾©èˆ‡ç›®çš„, é€£çµç¥è–ã€è¿½æ±‚æ„ç¾©ã€æ“‡å–„å›ºåŸ·ã€ä¸è®Šéš¨ç·£</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-014" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-014" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    
                        <div class="question-item fade-in" draggable="true" data-question-id="q-015">
                            <div class="question-content">
                                <div class="question-text">æˆ‘æœƒç‚ºè‡ªå·±çš„éŒ¯èª¤çœŸèª é“æ­‰</div>
                                <div class="question-meta">
                                    <span class="question-categories">äººéš›éˆä¿®, ç·©æ–¼ç™¼æ€’ã€æ•æ–¼å¯¬æ•ã€å‹‡æ–¼é“æ­‰ã€æ™‚æ™‚æ„Ÿæ©</span>
                                    
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="q-015" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="q-015" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- å³å´ï¼šé è¦½å’Œç‰ˆæœ¬ç®¡ç† -->
                <div class="editor-panel">
                    <div class="panel-header">
                        <div class="panel-title">å•å·é è¦½</div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <label style="font-size: 0.875rem;" class="tooltip" data-tooltip="éš¨æ©ŸåŒ–é¡Œç›®é †åº">
                                <input type="checkbox" id="toggle-preview-random"> éš¨æ©ŸåŒ–
                            </label>
                            <button class="btn btn-small btn-success" data-action="generate-survey">ç”Ÿæˆå•å·</button>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div id="preview-pane">
                    <div class="preview-header">
                        <h3>å•å·é è¦½</h3>
                        <div class="preview-info">
                            <span>å…± 15 é¡Œ</span>
                            <span>æ¨¡å¼: åˆ†é¡é †åº</span>
                        </div>
                    </div>
                    <div class="preview-intro">
                        æ‚¨æ˜¯å¦æ›¾æƒ³éï¼šæˆ‘çš„è¡Œç¨‹æ»¿æª”ï¼Œç‚ºä»€éº¼å…§å¿ƒæ·±è™•ä»æœƒæ„Ÿåˆ°ç©ºè™›ï¼Ÿä¸å¤ªç¢ºå®šäººç”Ÿçš„ç›®æ¨™èˆ‡æ„ç¾©æ„Ÿï¼Ÿæˆ‘çš„å…§å¿ƒèˆ‡äººéš›é—œä¿‚ç‚ºä½•å¸¸æœ‰ä¸€äº›è¡çªä¸å’Œè«§çš„åœ°æ–¹ï¼Ÿæƒ³è™•ç†é€™äº›å•é¡Œï¼Œè®“è‡ªå·±éå¾—æ›´å……å¯¦æ»¿è¶³ï¼Œå»ä¸çŸ¥é“å¾å“ªè£¡é–‹å§‹ï¼Ÿ<br><br>â€”â€”æˆ–è¨±ï¼Œæ˜¯æ™‚å€™ä¾†ç…§é¡§è‡ªå·±çš„ã€Œéˆæ€§å¥åº·ã€äº†ï¼<br><br>éˆæ€§å¥åº·æŒ‡çš„æ˜¯ä¸€å€‹äººå…§åœ¨æ˜¯å¦å®‰å®šã€æ˜ç™½ç”Ÿå‘½çš„æ„ç¾©ï¼Œèƒ½èˆ‡è‡ªå·±ã€ä»–äººã€è‡ªç„¶åŠæ›´å¤§çš„ç”Ÿå‘½é€£çµï¼Œå»ºç«‹å’Œè«§çš„é—œä¿‚ã€‚å®ƒè®“æˆ‘å€‘åœ¨å›°é›£ä¸­ä¸è¿·å¤±ï¼Œåœ¨æ—¥å¸¸ä¸­æ‰¾å›å¹³éœèˆ‡å¸Œæœ›ã€‚
                    </div>
                    <div class="preview-questions">
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">1.</div>
                                <div class="question-text">æˆ‘èƒ½å¤ è¦ºå¯Ÿè‡ªå·±å…§å¿ƒçš„æƒ³æ³•å’Œå‹•æ©Ÿ</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-001" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-001" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-001" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-001" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-001" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-001" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">2.</div>
                                <div class="question-text">æˆ‘æœƒåæ€è‡ªå·±çš„è¡Œç‚ºæ˜¯å¦ç¬¦åˆå…§å¿ƒçš„åƒ¹å€¼è§€</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-002" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-002" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-002" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-002" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-002" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-002" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">3.</div>
                                <div class="question-text">æˆ‘æ¸…æ¥šçŸ¥é“è‡ªå·±äººç”Ÿçš„ç›®æ¨™å’Œæ„ç¾©</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-003" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-003" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-003" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-003" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-003" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-003" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">4.</div>
                                <div class="question-text">æˆ‘èƒ½å¤ çœŸèª åœ°é—œæ„›ä»–äºº</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-004" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-004" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-004" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-004" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-004" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-004" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">5.</div>
                                <div class="question-text">æˆ‘æœƒåŸè«’æ›¾ç¶“å‚·å®³éæˆ‘çš„äºº</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-005" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-005" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-005" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-005" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-005" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-005" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">6.</div>
                                <div class="question-text">æˆ‘å°ç”Ÿæ´»ä¸­çš„ç¾å¥½äº‹ç‰©å¿ƒå­˜æ„Ÿæ¿€</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-006" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-006" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-006" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-006" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-006" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-006" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">7.</div>
                                <div class="question-text">æˆ‘æœƒåˆç†ä½¿ç”¨é‡‘éŒ¢å’Œç‰©è³ªè³‡æº</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-007" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-007" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-007" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-007" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-007" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-007" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">8.</div>
                                <div class="question-text">æˆ‘é—œå¿ƒç’°å¢ƒä¿è­·å’Œæ°¸çºŒç™¼å±•</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-008" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-008" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-008" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-008" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-008" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-008" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">9.</div>
                                <div class="question-text">æˆ‘æœƒä¸»å‹•å¹«åŠ©éœ€è¦å”åŠ©çš„äºº</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-009" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-009" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-009" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-009" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-009" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-009" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">10.</div>
                                <div class="question-text">æˆ‘èƒ½å¤ ä¿æŒå…§å¿ƒçš„å¹³éœå’Œå®‰å®š</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-010" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-010" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-010" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-010" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-010" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-010" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">11.</div>
                                <div class="question-text">æˆ‘æœƒé€éç¥ˆç¦±æˆ–å†¥æƒ³èˆ‡ç¥è–åŠ›é‡é€£çµ</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-011" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-011" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-011" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-011" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-011" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-011" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">12.</div>
                                <div class="question-text">æˆ‘çš„å®—æ•™ä¿¡ä»°ç‚ºæˆ‘çš„ç”Ÿæ´»å¸¶ä¾†æŒ‡å¼•</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-012" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-012" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-012" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-012" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-012" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-012" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">13.</div>
                                <div class="question-text">æˆ‘æœƒå®šæœŸé€²è¡Œè‡ªæˆ‘åçœ</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-013" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-013" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-013" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-013" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-013" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-013" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">14.</div>
                                <div class="question-text">æˆ‘èƒ½å¤ åœ¨å›°é›£ä¸­æ‰¾åˆ°æˆé•·çš„æ©Ÿæœƒ</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-014" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-014" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-014" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-014" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-014" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-014" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                            <div class="preview-question fade-in">
                                <div class="question-number">15.</div>
                                <div class="question-text">æˆ‘æœƒç‚ºè‡ªå·±çš„éŒ¯èª¤çœŸèª é“æ­‰</div>
                                <div class="scale-options">
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-015" value="1" disabled="">
                                            <span class="scale-label">1. å®Œå…¨ä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-015" value="2" disabled="">
                                            <span class="scale-label">2. å¾ˆä¸ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-015" value="3" disabled="">
                                            <span class="scale-label">3. ä¸å¤ªç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-015" value="4" disabled="">
                                            <span class="scale-label">4. æœ‰é»ç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-015" value="5" disabled="">
                                            <span class="scale-label">5. å¾ˆç¬¦åˆ</span>
                                        </label>
                                    
                                        <label class="scale-option">
                                            <input type="radio" name="preview-qq-015" value="6" disabled="">
                                            <span class="scale-label">6. å®Œå…¨ç¬¦åˆ</span>
                                        </label>
                                    
                                </div>
                            </div>
                        
                    </div>
                </div>
                        
                        <!-- ç‰ˆæœ¬ç®¡ç† -->
                        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e5e7eb;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h4>ç‰ˆæœ¬ç®¡ç†</h4>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button class="btn btn-small btn-secondary" data-action="save-version">å„²å­˜ç‰ˆæœ¬</button>
                                    <button class="btn btn-small btn-secondary" data-action="load-version">è¼‰å…¥ç‰ˆæœ¬</button>
                                </div>
                            </div>
                            <div id="version-list">
                    <div class="version-item fade-in">
                        <div class="version-info">
                            <div class="version-name">å•å·ç‰ˆæœ¬ 2025-08-15 16:44:30</div>
                            <div class="version-date">2025-08-15</div>
                        </div>
                        <div class="version-actions">
                            <button class="btn-small" data-action="load-specific-version" data-version-id="mecl0w5xy5ekvg5vbgp">è¼‰å…¥</button>
                            <button class="btn-small btn-danger" data-action="delete-version" data-version-id="mecl0w5xy5ekvg5vbgp">åˆªé™¤</button>
                        </div>
                    </div>
                
                    <div class="version-item fade-in">
                        <div class="version-info">
                            <div class="version-name">å•å·ç‰ˆæœ¬ 2025-08-15 15:23:04</div>
                            <div class="version-date">2025-08-15</div>
                        </div>
                        <div class="version-actions">
                            <button class="btn-small" data-action="load-specific-version" data-version-id="meci46dcnd6xcjdpm5q">è¼‰å…¥</button>
                            <button class="btn-small btn-danger" data-action="delete-version" data-version-id="meci46dcnd6xcjdpm5q">åˆªé™¤</button>
                        </div>
                    </div>
                </div>
                        </div>

                        <!-- è³‡æ–™ç®¡ç† -->
                        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e5e7eb;">
                            <h4 style="margin-bottom: 1rem;">è³‡æ–™ç®¡ç†</h4>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <button class="btn btn-small btn-secondary" data-action="export-library">åŒ¯å‡ºé¡Œåº«</button>
                                <button class="btn btn-small btn-secondary" data-action="import-library">åŒ¯å…¥é¡Œåº«</button>
                                <button class="btn btn-small btn-secondary" data-action="export-responses">åŒ¯å‡ºå›è¦†</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä½œç­”é é¢ -->
    <div id="survey-page" class="page">
        <div class="survey-container">
            <div class="survey-header">
                <div class="survey-title">éˆæ€§ä¿®é¤Šå•å·</div>
                <div class="survey-subtitle">æ¢ç´¢æ‚¨çš„å…§åœ¨ä¸–ç•Œ</div>
            </div>
            
            <div class="survey-content">
                <!-- å¼•å°èª -->
                <div id="intro-text" class="survey-intro"></div>

                <!-- é€²åº¦æ¢ -->
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>

                <!-- å•å·è¡¨å–® -->
                <form id="answer-form">
                    <div id="survey-questions"></div>
                </form>

                <!-- å€‹äººè³‡æ–™è¡¨å–® -->
                <div id="profile-form" class="demographics-form hidden">
                    <div class="demographics-title">å€‹äººåŸºæœ¬è³‡æ–™</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">å§“å *</label>
                            <input type="text" name="name" class="form-input" required="">
                            <div class="error-message" id="name-error"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ç”Ÿæ—¥ *</label>
                            <input type="date" name="birth" class="form-input" required="">
                            <div class="error-message" id="birth-error"></div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">æ€§åˆ¥ *</label>
                            <select name="gender" class="form-select" required="">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="ç”·æ€§">ç”·æ€§</option>
                                <option value="å¥³æ€§">å¥³æ€§</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                            <div class="error-message" id="gender-error"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">åœ‹ç± *</label>
                            <input type="text" name="nationality" class="form-input" required="">
                            <div class="error-message" id="nationality-error"></div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ç›®å‰å±…ä½åŸå¸‚ *</label>
                            <input type="text" name="city" class="form-input" required="">
                            <div class="error-message" id="city-error"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">è·æ¥­ *</label>
                            <input type="text" name="profession" class="form-input" required="">
                            <div class="error-message" id="profession-error"></div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">æ•™è‚²ç¨‹åº¦ *</label>
                            <select name="education" class="form-select" required="">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="åœ‹å°åŠä»¥ä¸‹">åœ‹å°åŠä»¥ä¸‹</option>
                                <option value="åœ‹ä¸­">åœ‹ä¸­</option>
                                <option value="é«˜ä¸­è·">é«˜ä¸­è·</option>
                                <option value="å°ˆç§‘">å°ˆç§‘</option>
                                <option value="å¤§å­¸">å¤§å­¸</option>
                                <option value="ç¢©å£«">ç¢©å£«</option>
                                <option value="åšå£«">åšå£«</option>
                            </select>
                            <div class="error-message" id="education-error"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å©šå§»ç‹€æ³ *</label>
                            <select name="marital" class="form-select" required="">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="æœªå©š">æœªå©š</option>
                                <option value="å·²å©š">å·²å©š</option>
                                <option value="é›¢å©š">é›¢å©š</option>
                                <option value="å–ªå¶">å–ªå¶</option>
                            </select>
                            <div class="error-message" id="marital-error"></div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">å®—æ•™ä¿¡ä»° *</label>
                            <select name="religion" class="form-select" required="">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="ç„¡å®—æ•™ä¿¡ä»°">ç„¡å®—æ•™ä¿¡ä»°</option>
                                <option value="ä½›æ•™">ä½›æ•™</option>
                                <option value="é“æ•™">é“æ•™</option>
                                <option value="åŸºç£æ•™">åŸºç£æ•™</option>
                                <option value="å¤©ä¸»æ•™">å¤©ä¸»æ•™</option>
                                <option value="ä¼Šæ–¯è˜­æ•™">ä¼Šæ–¯è˜­æ•™</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                            <div class="error-message" id="religion-error"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å±…ä½ç‹€æ³ *</label>
                            <select name="living" class="form-select" required="">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="ç¨å±…">ç¨å±…</option>
                                <option value="èˆ‡è¦ªå±¬åŒä½">èˆ‡è¦ªå±¬åŒä½</option>
                                <option value="èˆ‡éè¦ªå±¬åŒä½">èˆ‡éè¦ªå±¬åŒä½</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                            <div class="error-message" id="living-error"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æª¢æ¸¬æ—¥æœŸ *</label>
                        <input type="date" name="testDate" class="form-input" required="">
                        <div class="error-message" id="testDate-error"></div>
                    </div>
                </div>

                <!-- æäº¤æŒ‰éˆ• -->
                <div style="text-align: center; margin-top: 2rem;">
                    <button type="button" class="btn btn-primary" id="btn-submit" data-action="submit-survey">æäº¤å•å·</button>
                </div>

                <!-- çµæœåˆ†æ -->
                <div id="result-panel" class="results-container hidden">
                    <div class="results-header">
                        <div class="results-title">åˆ†æçµæœ</div>
                        <div class="results-subtitle">æ‚¨çš„éˆæ€§ä¿®é¤Šè©•ä¼°å ±å‘Š</div>
                    </div>

                    <div class="results-grid">
                        <div class="result-card">
                            <div class="result-card-title">éˆæ€§ä¿®é¤Šä¸ƒé¢å‘</div>
                            <div id="facets-scores"></div>
                        </div>
                        <div class="result-card">
                            <div class="result-card-title">éˆæ€§å¥åº·åæ ¸å¿ƒæŒ‡æ¨™</div>
                            <div id="indicators-scores"></div>
                        </div>
                        <div class="result-card">
                            <div class="result-card-title">éˆä¿®ä¸ƒåŸå‰‡</div>
                            <div id="principles-scores"></div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">éˆæ€§ä¿®é¤Šä¸ƒé¢å‘é›·é”åœ–</div>
                        <canvas id="radar-chart" class="chart-canvas"></canvas>
                    </div>

                    <div class="suggestions">
                        <div class="suggestions-title">å€‹äººåŒ–å»ºè­°</div>
                        <div id="suggestions-content"></div>
                    </div>

                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-secondary" data-action="export-json">ä¸‹è¼‰ JSON</button>
                        <button class="btn btn-secondary" data-action="export-csv">ä¸‹è¼‰ CSV</button>
                        <button class="btn btn-primary" data-action="restart-survey">é‡æ–°ä½œç­”</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ†é¡æ¨¡æ…‹æ¡† -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">åˆ†é¡ç®¡ç†</div>
                <button class="modal-close" data-action="close-modal">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="category-form">
                    <div class="form-group">
                        <label class="form-label">åˆ†é¡åç¨± *</label>
                        <input type="text" name="name" id="category-name" class="form-input" required="">
                        <div class="error-message" id="category-name-error"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">åˆ†é¡å±¤ç´š *</label>
                        <select name="layer" id="category-layer" class="form-select" required="">
                            <option value="">è«‹é¸æ“‡</option>
                        </select>
                        <div class="error-message" id="category-layer-error"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">çˆ¶åˆ†é¡</label>
                        <select name="parent" id="category-parent" class="form-select">
                            <option value="">ç„¡ï¼ˆæ ¹åˆ†é¡ï¼‰</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-action="close-modal">å–æ¶ˆ</button>
                <button type="submit" form="category-form" class="btn btn-primary" data-action="save-category">å„²å­˜</button>
            </div>
        </div>
    </div>

    <!-- é¡Œç›®æ¨¡æ…‹æ¡† -->
    <div id="question-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">é¡Œç›®ç®¡ç†</div>
                <button class="modal-close" data-action="close-modal">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="question-form">
                    <div class="form-group">
                        <label class="form-label">é¡Œç›®å…§å®¹ *</label>
                        <textarea name="text" id="q-text" class="form-input" rows="3" required=""></textarea>
                        <div class="error-message" id="question-text-error"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ‰€å±¬åˆ†é¡ *</label>
                        <div id="question-categories"></div>
                        <div class="error-message" id="question-categories-error"></div>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="isReligious" id="q-is-religious">
                            <span>å®—æ•™æ€§é¡Œç›®</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-action="close-modal">å–æ¶ˆ</button>
                <button type="submit" form="question-form" class="btn btn-primary" data-action="save-question">å„²å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç‰ˆæœ¬æ¨¡æ…‹æ¡† -->
    <div id="version-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ç‰ˆæœ¬ç®¡ç†</div>
                <button class="modal-close" data-action="close-modal">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="version-list-modal"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-action="close-modal">é—œé–‰</button>
            </div>
        </div>
    </div>

    <script>
        'use strict';

        // ===== å…¨åŸŸå¸¸æ•¸å’Œé…ç½® =====
        
        const CONFIG = {
            // åˆ†é¡å±¤ç´šé¡å‹
            LAYER_TYPES: {
                FACETS_7: 'FACETS_7',
                INDICATORS_10: 'INDICATORS_10',
                PRINCIPLES_7: 'PRINCIPLES_7',
                PRACTICES: 'PRACTICES'
            },
            
            // åˆ†é¡å±¤ç´šåç¨±
            LAYER_NAMES: {
                FACETS_7: 'éˆæ€§ä¿®é¤Šä¸ƒé¢å‘',
                INDICATORS_10: 'éˆæ€§å¥åº·åæ ¸å¿ƒæŒ‡æ¨™',
                PRINCIPLES_7: 'éˆä¿®ä¸ƒåŸå‰‡',
                PRACTICES: 'æ—¥å¸¸éˆä¿®å¯¦è¸'
            },
            
            // 6åˆ†é‡è¡¨é¸é …
            SCALE_OPTIONS: [
                { value: 1, label: 'å®Œå…¨ä¸ç¬¦åˆ' },
                { value: 2, label: 'å¾ˆä¸ç¬¦åˆ' },
                { value: 3, label: 'ä¸å¤ªç¬¦åˆ' },
                { value: 4, label: 'æœ‰é»ç¬¦åˆ' },
                { value: 5, label: 'å¾ˆç¬¦åˆ' },
                { value: 6, label: 'å®Œå…¨ç¬¦åˆ' }
            ],
            
            // å›ºå®šå¼•å°èª
            SURVEY_INTRO_TEXT: `æ‚¨æ˜¯å¦æ›¾æƒ³éï¼šæˆ‘çš„è¡Œç¨‹æ»¿æª”ï¼Œç‚ºä»€éº¼å…§å¿ƒæ·±è™•ä»æœƒæ„Ÿåˆ°ç©ºè™›ï¼Ÿä¸å¤ªç¢ºå®šäººç”Ÿçš„ç›®æ¨™èˆ‡æ„ç¾©æ„Ÿï¼Ÿæˆ‘çš„å…§å¿ƒèˆ‡äººéš›é—œä¿‚ç‚ºä½•å¸¸æœ‰ä¸€äº›è¡çªä¸å’Œè«§çš„åœ°æ–¹ï¼Ÿæƒ³è™•ç†é€™äº›å•é¡Œï¼Œè®“è‡ªå·±éå¾—æ›´å……å¯¦æ»¿è¶³ï¼Œå»ä¸çŸ¥é“å¾å“ªè£¡é–‹å§‹ï¼Ÿ

â€”â€”æˆ–è¨±ï¼Œæ˜¯æ™‚å€™ä¾†ç…§é¡§è‡ªå·±çš„ã€Œéˆæ€§å¥åº·ã€äº†ï¼

éˆæ€§å¥åº·æŒ‡çš„æ˜¯ä¸€å€‹äººå…§åœ¨æ˜¯å¦å®‰å®šã€æ˜ç™½ç”Ÿå‘½çš„æ„ç¾©ï¼Œèƒ½èˆ‡è‡ªå·±ã€ä»–äººã€è‡ªç„¶åŠæ›´å¤§çš„ç”Ÿå‘½é€£çµï¼Œå»ºç«‹å’Œè«§çš„é—œä¿‚ã€‚å®ƒè®“æˆ‘å€‘åœ¨å›°é›£ä¸­ä¸è¿·å¤±ï¼Œåœ¨æ—¥å¸¸ä¸­æ‰¾å›å¹³éœèˆ‡å¸Œæœ›ã€‚`,
            
            // å„²å­˜éµå€¼
            STORAGE_KEYS: {
                CATEGORIES: 'sss.categories',
                QUESTIONS: 'sss.questions',
                VERSIONS: 'sss.versions',
                RESPONSES: 'sss.responses',
                SETTINGS: 'sss.settings'
            },
            
            // é˜²æŠ–å»¶é²
            DEBOUNCE_DELAY: 300,
            
            // Toast é¡¯ç¤ºæ™‚é–“
            TOAST_DURATION: 3000
        };

        // åˆå§‹åˆ†é¡è³‡æ–™
        const INITIAL_CATEGORIES = [
            // éˆæ€§ä¿®é¤Šä¸ƒé¢å‘
            { id: 'facet-1', layer: 'FACETS_7', name: 'èµ·å¿ƒå‹•å¿µ', parentId: null, order: 1 },
            { id: 'facet-2', layer: 'FACETS_7', name: 'å¾Œè¨­æ€è€ƒ', parentId: null, order: 2 },
            { id: 'facet-3', layer: 'FACETS_7', name: 'æ„ç¾©è¿½å°‹', parentId: null, order: 3 },
            { id: 'facet-4', layer: 'FACETS_7', name: 'äººéš›éˆä¿®', parentId: null, order: 4 },
            { id: 'facet-5', layer: 'FACETS_7', name: 'ç‰©è³ªèˆ‡ç’°å¢ƒ', parentId: null, order: 5 },
            { id: 'facet-6', layer: 'FACETS_7', name: 'èˆ‡è¶…è¶Šè€…çš„é€£çµ', parentId: null, order: 6 },
            { id: 'facet-7', layer: 'FACETS_7', name: 'ç”Ÿæ´»å½¢æ…‹èˆ‡å…¨äººå¥åº·', parentId: null, order: 7 },
            
            // éˆæ€§å¥åº·åæ ¸å¿ƒæŒ‡æ¨™
            { id: 'indicator-1', layer: 'INDICATORS_10', name: 'äººæ ¼çµ±æ•´', parentId: null, order: 1 },
            { id: 'indicator-2', layer: 'INDICATORS_10', name: 'è¿½æ±‚çœŸç†çš„å¾Œè¨­åæ€', parentId: null, order: 2 },
            { id: 'indicator-3', layer: 'INDICATORS_10', name: 'æ„ç¾©èˆ‡ç›®çš„', parentId: null, order: 3 },
            { id: 'indicator-4', layer: 'INDICATORS_10', name: 'æ„›èˆ‡åŒç†', parentId: null, order: 4 },
            { id: 'indicator-5', layer: 'INDICATORS_10', name: 'å¯¬æ•èˆ‡å’Œè§£', parentId: null, order: 5 },
            { id: 'indicator-6', layer: 'INDICATORS_10', name: 'æ„Ÿæ©èˆ‡å–œæ¨‚', parentId: null, order: 6 },
            { id: 'indicator-7', layer: 'INDICATORS_10', name: 'è²¡ç‰©å€«ç†èˆ‡éˆä¿®', parentId: null, order: 7 },
            { id: 'indicator-8', layer: 'INDICATORS_10', name: 'æƒœç‰©èˆ‡å…±ç”Ÿ', parentId: null, order: 8 },
            { id: 'indicator-9', layer: 'INDICATORS_10', name: 'ä¿¡ä»°èˆ‡é€£çµ', parentId: null, order: 9, isReligious: true },
            { id: 'indicator-10', layer: 'INDICATORS_10', name: 'å®—æ•™ä¿¡ä»°èˆ‡éˆæ€§ä¿®é¤Š', parentId: null, order: 10, isReligious: true },
            
            // éˆä¿®ä¸ƒåŸå‰‡
            { id: 'principle-1', layer: 'PRINCIPLES_7', name: 'åœ¨æ¯ä¸€å€‹äººèº«ä¸Šçœ‹è¦‹ç¥ã€çœ‹è¦‹ä½›ã€çœ‹è¦‹äºº', parentId: null, order: 1 },
            { id: 'principle-2', layer: 'PRINCIPLES_7', name: 'ç¬¬ä¸€å€‹å»æ„›ã€ç¬¬ä¸€å€‹å»çµ¦', parentId: null, order: 2 },
            { id: 'principle-3', layer: 'PRINCIPLES_7', name: 'çµ¦äººä¿¡å¿ƒã€çµ¦äººå¸Œæœ›ã€çµ¦äººæ­¡å–œã€çµ¦äººæ–¹ä¾¿', parentId: null, order: 3 },
            { id: 'principle-4', layer: 'PRINCIPLES_7', name: 'ç·©æ–¼ç™¼æ€’ã€æ•æ–¼å¯¬æ•ã€å‹‡æ–¼é“æ­‰ã€æ™‚æ™‚æ„Ÿæ©', parentId: null, order: 4 },
            { id: 'principle-5', layer: 'PRINCIPLES_7', name: 'é€£çµç¥è–ã€è¿½æ±‚æ„ç¾©ã€æ“‡å–„å›ºåŸ·ã€ä¸è®Šéš¨ç·£', parentId: null, order: 5 },
            { id: 'principle-6', layer: 'PRINCIPLES_7', name: 'å½¹ç‰©ä¸å½¹æ–¼ç‰©ï¼Œæƒœç‰©åšç”Ÿæ¿Ÿä¸–', parentId: null, order: 6 },
            { id: 'principle-7', layer: 'PRINCIPLES_7', name: 'èª æ„æ­£å¿ƒã€æˆ’æ…ææ‡¼ã€å¾Œè¨­åæ€ã€é–‹æ”¾å…¬æ­£', parentId: null, order: 7 }
        ];

        // åˆå§‹é¡Œç›®è³‡æ–™
        const INITIAL_QUESTIONS = [
            { id: 'q-001', text: 'æˆ‘èƒ½å¤ è¦ºå¯Ÿè‡ªå·±å…§å¿ƒçš„æƒ³æ³•å’Œå‹•æ©Ÿ', categoryIds: ['facet-1', 'indicator-1'], isReligious: false, order: 1 },
            { id: 'q-002', text: 'æˆ‘æœƒåæ€è‡ªå·±çš„è¡Œç‚ºæ˜¯å¦ç¬¦åˆå…§å¿ƒçš„åƒ¹å€¼è§€', categoryIds: ['facet-2', 'indicator-2', 'principle-7'], isReligious: false, order: 2 },
            { id: 'q-003', text: 'æˆ‘æ¸…æ¥šçŸ¥é“è‡ªå·±äººç”Ÿçš„ç›®æ¨™å’Œæ„ç¾©', categoryIds: ['facet-3', 'indicator-3'], isReligious: false, order: 3 },
            { id: 'q-004', text: 'æˆ‘èƒ½å¤ çœŸèª åœ°é—œæ„›ä»–äºº', categoryIds: ['facet-4', 'indicator-4', 'principle-1', 'principle-2'], isReligious: false, order: 4 },
            { id: 'q-005', text: 'æˆ‘æœƒåŸè«’æ›¾ç¶“å‚·å®³éæˆ‘çš„äºº', categoryIds: ['facet-4', 'indicator-5', 'principle-4'], isReligious: false, order: 5 },
            { id: 'q-006', text: 'æˆ‘å°ç”Ÿæ´»ä¸­çš„ç¾å¥½äº‹ç‰©å¿ƒå­˜æ„Ÿæ¿€', categoryIds: ['indicator-6', 'principle-4'], isReligious: false, order: 6 },
            { id: 'q-007', text: 'æˆ‘æœƒåˆç†ä½¿ç”¨é‡‘éŒ¢å’Œç‰©è³ªè³‡æº', categoryIds: ['facet-5', 'indicator-7', 'principle-6'], isReligious: false, order: 7 },
            { id: 'q-008', text: 'æˆ‘é—œå¿ƒç’°å¢ƒä¿è­·å’Œæ°¸çºŒç™¼å±•', categoryIds: ['facet-5', 'indicator-8', 'principle-6'], isReligious: false, order: 8 },
            { id: 'q-009', text: 'æˆ‘æœƒä¸»å‹•å¹«åŠ©éœ€è¦å”åŠ©çš„äºº', categoryIds: ['facet-4', 'principle-2', 'principle-3'], isReligious: false, order: 9 },
            { id: 'q-010', text: 'æˆ‘èƒ½å¤ ä¿æŒå…§å¿ƒçš„å¹³éœå’Œå®‰å®š', categoryIds: ['facet-7', 'indicator-1'], isReligious: false, order: 10 },
            { id: 'q-011', text: 'æˆ‘æœƒé€éç¥ˆç¦±æˆ–å†¥æƒ³èˆ‡ç¥è–åŠ›é‡é€£çµ', categoryIds: ['facet-6', 'indicator-9'], isReligious: true, order: 11 },
            { id: 'q-012', text: 'æˆ‘çš„å®—æ•™ä¿¡ä»°ç‚ºæˆ‘çš„ç”Ÿæ´»å¸¶ä¾†æŒ‡å¼•', categoryIds: ['facet-6', 'indicator-10'], isReligious: true, order: 12 },
            { id: 'q-013', text: 'æˆ‘æœƒå®šæœŸé€²è¡Œè‡ªæˆ‘åçœ', categoryIds: ['facet-2', 'indicator-2', 'principle-7'], isReligious: false, order: 13 },
            { id: 'q-014', text: 'æˆ‘èƒ½å¤ åœ¨å›°é›£ä¸­æ‰¾åˆ°æˆé•·çš„æ©Ÿæœƒ', categoryIds: ['facet-3', 'indicator-3', 'principle-5'], isReligious: false, order: 14 },
            { id: 'q-015', text: 'æˆ‘æœƒç‚ºè‡ªå·±çš„éŒ¯èª¤çœŸèª é“æ­‰', categoryIds: ['facet-4', 'principle-4'], isReligious: false, order: 15 }
        ];

        // ===== å·¥å…·å‡½æ•¸ =====
        
        class Utils {
            // ç”Ÿæˆå”¯ä¸€ ID
            static generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            // æ·±æ‹·è²
            static deepClone(obj) {
                if (obj === null || typeof obj !== 'object') return obj;
                if (obj instanceof Date) return new Date(obj.getTime());
                if (obj instanceof Array) return obj.map(item => Utils.deepClone(item));
                if (typeof obj === 'object') {
                    const clonedObj = {};
                    for (const key in obj) {
                        if (obj.hasOwnProperty(key)) {
                            clonedObj[key] = Utils.deepClone(obj[key]);
                        }
                    }
                    return clonedObj;
                }
                return obj;
            }

            // æ—¥æœŸæ ¼å¼åŒ–
            static formatDate(date, format = 'YYYY-MM-DD') {
                if (!(date instanceof Date)) {
                    date = new Date(date);
                }
                
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                const seconds = String(date.getSeconds()).padStart(2, '0');
                
                return format
                    .replace('YYYY', year)
                    .replace('MM', month)
                    .replace('DD', day)
                    .replace('HH', hours)
                    .replace('mm', minutes)
                    .replace('ss', seconds);
            }

            // é˜²æŠ–å‡½æ•¸
            static debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func.apply(this, args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // ç¯€æµå‡½æ•¸
            static throttle(func, limit) {
                let inThrottle;
                return function(...args) {
                    if (!inThrottle) {
                        func.apply(this, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            }

            // é™£åˆ—éš¨æ©Ÿæ’åº
            static shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            // ä¸‹è¼‰æ–‡ä»¶
            static downloadFile(data, filename, type = 'application/json') {
                const blob = new Blob([data], { type });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // é©—è­‰é›»å­éƒµä»¶
            static validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            // æ¸…ç† HTML
            static sanitizeHtml(str) {
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            }

            // æª¢æŸ¥æ˜¯å¦ç‚ºç©ºå€¼
            static isEmpty(value) {
                return value === null || value === undefined || 
                       (typeof value === 'string' && value.trim() === '') ||
                       (Array.isArray(value) && value.length === 0) ||
                       (typeof value === 'object' && Object.keys(value).length === 0);
            }
        }

        // ===== å„²å­˜ç®¡ç†å™¨ =====
        
        class StorageManager {
            constructor() {
                this.keys = CONFIG.STORAGE_KEYS;
                this.isAvailable = this.checkAvailability();
            }

            // æª¢æŸ¥ localStorage å¯ç”¨æ€§
            checkAvailability() {
                try {
                    const test = '__storage_test__';
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch (e) {
                    console.error('localStorage ä¸å¯ç”¨:', e);
                    return false;
                }
            }

            // åˆå§‹åŒ–
            async init() {
                try {
                    if (!this.isAvailable) {
                        throw new Error('å„²å­˜ç³»çµ±ä¸å¯ç”¨');
                    }

                    // æª¢æŸ¥æ˜¯å¦å·²æœ‰è³‡æ–™
                    if (!this.getCategories().length) {
                        await this.saveCategories(INITIAL_CATEGORIES);
                    }
                    if (!this.getQuestions().length) {
                        await this.saveQuestions(INITIAL_QUESTIONS);
                    }
                    return true;
                } catch (error) {
                    console.error('å„²å­˜ç³»çµ±åˆå§‹åŒ–å¤±æ•—:', error);
                    throw error;
                }
            }

            // ç²å–è³‡æ–™
            get(key) {
                try {
                    if (!this.isAvailable) return null;
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('è®€å–è³‡æ–™å¤±æ•—:', error);
                    return null;
                }
            }

            // å„²å­˜è³‡æ–™
            async set(key, data) {
                try {
                    if (!this.isAvailable) {
                        throw new Error('å„²å­˜ç³»çµ±ä¸å¯ç”¨');
                    }
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('å„²å­˜è³‡æ–™å¤±æ•—:', error);
                    throw error;
                }
            }

            // åˆ†é¡ç®¡ç†
            getCategories() {
                return this.get(this.keys.CATEGORIES) || [];
            }

            async saveCategories(categories) {
                if (!Array.isArray(categories)) {
                    throw new Error('åˆ†é¡è³‡æ–™å¿…é ˆæ˜¯é™£åˆ—');
                }
                return await this.set(this.keys.CATEGORIES, categories);
            }

            async addCategory(category) {
                if (!category || !category.id || !category.name) {
                    throw new Error('åˆ†é¡è³‡æ–™ä¸å®Œæ•´');
                }
                const categories = this.getCategories();
                categories.push(category);
                return await this.saveCategories(categories);
            }

            async updateCategory(id, data) {
                if (!id || !data) {
                    throw new Error('æ›´æ–°åˆ†é¡éœ€è¦ ID å’Œè³‡æ–™');
                }
                const categories = this.getCategories();
                const index = categories.findIndex(c => c.id === id);
                if (index === -1) {
                    throw new Error('æ‰¾ä¸åˆ°æŒ‡å®šçš„åˆ†é¡');
                }
                categories[index] = { ...categories[index], ...data };
                return await this.saveCategories(categories);
            }

            async deleteCategory(id) {
                if (!id) {
                    throw new Error('åˆªé™¤åˆ†é¡éœ€è¦ ID');
                }
                const categories = this.getCategories();
                const filtered = categories.filter(c => c.id !== id);
                return await this.saveCategories(filtered);
            }

            // é¡Œç›®ç®¡ç†
            getQuestions() {
                return this.get(this.keys.QUESTIONS) || [];
            }

            async saveQuestions(questions) {
                if (!Array.isArray(questions)) {
                    throw new Error('é¡Œç›®è³‡æ–™å¿…é ˆæ˜¯é™£åˆ—');
                }
                return await this.set(this.keys.QUESTIONS, questions);
            }

            async addQuestion(question) {
                if (!question || !question.id || !question.text) {
                    throw new Error('é¡Œç›®è³‡æ–™ä¸å®Œæ•´');
                }
                const questions = this.getQuestions();
                questions.push(question);
                return await this.saveQuestions(questions);
            }

            async updateQuestion(id, data) {
                if (!id || !data) {
                    throw new Error('æ›´æ–°é¡Œç›®éœ€è¦ ID å’Œè³‡æ–™');
                }
                const questions = this.getQuestions();
                const index = questions.findIndex(q => q.id === id);
                if (index === -1) {
                    throw new Error('æ‰¾ä¸åˆ°æŒ‡å®šçš„é¡Œç›®');
                }
                questions[index] = { ...questions[index], ...data };
                return await this.saveQuestions(questions);
            }

            async deleteQuestion(id) {
                if (!id) {
                    throw new Error('åˆªé™¤é¡Œç›®éœ€è¦ ID');
                }
                const questions = this.getQuestions();
                const filtered = questions.filter(q => q.id !== id);
                return await this.saveQuestions(filtered);
            }

            // ç‰ˆæœ¬ç®¡ç†
            getVersions() {
                return this.get(this.keys.VERSIONS) || [];
            }

            async saveVersions(versions) {
                if (!Array.isArray(versions)) {
                    throw new Error('ç‰ˆæœ¬è³‡æ–™å¿…é ˆæ˜¯é™£åˆ—');
                }
                return await this.set(this.keys.VERSIONS, versions);
            }

            async createVersion(name, settings) {
                if (!name) {
                    throw new Error('ç‰ˆæœ¬åç¨±ä¸èƒ½ç‚ºç©º');
                }
                
                const version = {
                    id: Utils.generateId(),
                    name,
                    createdAt: new Date().toISOString(),
                    settings: settings || {},
                    snapshot: {
                        categories: this.getCategories(),
                        questions: this.getQuestions()
                    }
                };

                const versions = this.getVersions();
                versions.push(version);
                await this.saveVersions(versions);
                return version;
            }

            getVersion(id) {
                if (!id) return null;
                const versions = this.getVersions();
                return versions.find(v => v.id === id);
            }

            async loadVersion(id) {
                if (!id) {
                    throw new Error('è¼‰å…¥ç‰ˆæœ¬éœ€è¦ ID');
                }
                const version = this.getVersion(id);
                if (!version) {
                    throw new Error('æ‰¾ä¸åˆ°æŒ‡å®šçš„ç‰ˆæœ¬');
                }
                
                await this.saveCategories(version.snapshot.categories);
                await this.saveQuestions(version.snapshot.questions);
                return version;
            }

            async deleteVersion(id) {
                if (!id) {
                    throw new Error('åˆªé™¤ç‰ˆæœ¬éœ€è¦ ID');
                }
                const versions = this.getVersions();
                const filtered = versions.filter(v => v.id !== id);
                return await this.saveVersions(filtered);
            }

            // å›è¦†ç®¡ç†
            getResponses() {
                return this.get(this.keys.RESPONSES) || [];
            }

            async saveResponse(response) {
                if (!response || !response.id) {
                    throw new Error('å›è¦†è³‡æ–™ä¸å®Œæ•´');
                }
                const responses = this.getResponses();
                responses.push(response);
                return await this.set(this.keys.RESPONSES, responses);
            }

            // è¨­å®šç®¡ç†
            getSettings() {
                return this.get(this.keys.SETTINGS) || {};
            }

            async setSetting(key, value) {
                if (!key) {
                    throw new Error('è¨­å®šéµå€¼ä¸èƒ½ç‚ºç©º');
                }
                const settings = this.getSettings();
                settings[key] = value;
                return await this.set(this.keys.SETTINGS, settings);
            }

            // çµ±è¨ˆè³‡è¨Š
            getStats() {
                return {
                    categories: { total: this.getCategories().length },
                    questions: { total: this.getQuestions().length },
                    versions: { total: this.getVersions().length },
                    responses: { total: this.getResponses().length }
                };
            }

            // åŒ¯å‡ºé¡Œåº«
            exportLibrary() {
                return {
                    categories: this.getCategories(),
                    questions: this.getQuestions(),
                    versions: this.getVersions(),
                    exportedAt: new Date().toISOString(),
                    version: '1.0.0'
                };
            }

            // åŒ¯å…¥é¡Œåº«
            async importLibrary(data) {
                if (!data || typeof data !== 'object') {
                    throw new Error('åŒ¯å…¥è³‡æ–™æ ¼å¼éŒ¯èª¤');
                }
                
                if (data.categories && Array.isArray(data.categories)) {
                    await this.saveCategories(data.categories);
                }
                if (data.questions && Array.isArray(data.questions)) {
                    await this.saveQuestions(data.questions);
                }
                if (data.versions && Array.isArray(data.versions)) {
                    await this.saveVersions(data.versions);
                }
                return true;
            }
        }

        // ===== UI ç®¡ç†å™¨ =====
        
        class UIManager {
            constructor() {
                this.loadingOverlay = document.getElementById('loading-overlay');
                this.toastContainer = null;
                this.createToastContainer();
            }

            // å‰µå»º Toast å®¹å™¨
            createToastContainer() {
                if (!this.toastContainer) {
                    this.toastContainer = document.createElement('div');
                    this.toastContainer.id = 'toast-container';
                    this.toastContainer.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        z-index: 2000;
                        pointer-events: none;
                    `;
                    document.body.appendChild(this.toastContainer);
                }
            }

            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            showLoading() {
                if (this.loadingOverlay) {
                    this.loadingOverlay.classList.add('show');
                }
            }

            // éš±è—è¼‰å…¥ç‹€æ…‹
            hideLoading() {
                if (this.loadingOverlay) {
                    this.loadingOverlay.classList.remove('show');
                }
            }

            // é¡¯ç¤º Toast é€šçŸ¥
            showToast(message, type = 'info', duration = CONFIG.TOAST_DURATION) {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                toast.style.pointerEvents = 'auto';
                
                this.toastContainer.appendChild(toast);

                // è§¸ç™¼å‹•ç•«
                setTimeout(() => toast.classList.add('show'), 100);

                // è‡ªå‹•ç§»é™¤
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            this.toastContainer.removeChild(toast);
                        }
                    }, 300);
                }, duration);

                return toast;
            }

            // é é¢åˆ‡æ›
            showPage(pageId) {
                // éš±è—æ‰€æœ‰é é¢
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });

                // é¡¯ç¤ºæŒ‡å®šé é¢
                const targetPage = document.getElementById(pageId + '-page');
                if (targetPage) {
                    targetPage.classList.add('active');
                    
                    // å¦‚æœæ˜¯å•å·é é¢ï¼Œåˆå§‹åŒ–å•å·
                    if (pageId === 'survey') {
                        app.initSurvey();
                    }
                } else {
                    console.error('æ‰¾ä¸åˆ°é é¢:', pageId);
                }
            }

            // é¡¯ç¤ºæ¨¡æ…‹æ¡†
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('active');
                    // èšç„¦åˆ°ç¬¬ä¸€å€‹è¼¸å…¥æ¬„ä½
                    const firstInput = modal.querySelector('input, textarea, select');
                    if (firstInput) {
                        setTimeout(() => firstInput.focus(), 100);
                    }
                }
            }

            // éš±è—æ¨¡æ…‹æ¡†
            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            // éš±è—æ‰€æœ‰æ¨¡æ…‹æ¡†
            hideAllModals() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });
            }

            // é¡¯ç¤ºç¢ºèªå°è©±æ¡†
            async showConfirm(message, title = 'ç¢ºèª') {
                return new Promise((resolve) => {
                    const result = confirm(`${title}\n\n${message}`);
                    resolve(result);
                });
            }

            // é¡¯ç¤ºè¼¸å…¥å°è©±æ¡†
            async showPrompt(message, defaultValue = '', title = 'è¼¸å…¥') {
                return new Promise((resolve) => {
                    const result = prompt(`${title}\n\n${message}`, defaultValue);
                    resolve(result);
                });
            }

            // æ¸…é™¤è¡¨å–®éŒ¯èª¤
            clearFormErrors(formId) {
                const form = document.getElementById(formId);
                if (form) {
                    form.querySelectorAll('.error-message').forEach(error => {
                        error.textContent = '';
                    });
                    form.querySelectorAll('.form-input, .form-select').forEach(input => {
                        input.classList.remove('error');
                    });
                }
            }

            // é¡¯ç¤ºè¡¨å–®éŒ¯èª¤
            showFormError(fieldName, message) {
                const errorElement = document.getElementById(fieldName + '-error');
                const inputElement = document.querySelector(`[name="${fieldName}"]`);
                
                if (errorElement) {
                    errorElement.textContent = message;
                }
                if (inputElement) {
                    inputElement.classList.add('error');
                }
            }

            // é©—è­‰è¡¨å–®
            validateForm(formId, rules) {
                const form = document.getElementById(formId);
                if (!form) return false;

                this.clearFormErrors(formId);
                let isValid = true;

                const formData = new FormData(form);
                
                for (const [fieldName, rule] of Object.entries(rules)) {
                    const value = formData.get(fieldName);
                    
                    if (rule.required && Utils.isEmpty(value)) {
                        this.showFormError(fieldName, rule.requiredMessage || 'æ­¤æ¬„ä½ç‚ºå¿…å¡«');
                        isValid = false;
                        continue;
                    }
                    
                    if (value && rule.validator && !rule.validator(value)) {
                        this.showFormError(fieldName, rule.validatorMessage || 'æ ¼å¼ä¸æ­£ç¢º');
                        isValid = false;
                    }
                }

                return isValid;
            }
        }

        // ===== äº‹ä»¶ç®¡ç†å™¨ =====
        
        class EventManager {
            constructor() {
                this.handlers = new Map();
                this.setupGlobalEventListeners();
            }

            // è¨­ç½®å…¨åŸŸäº‹ä»¶ç›£è½å™¨
            setupGlobalEventListeners() {
                // ä½¿ç”¨äº‹ä»¶å§”è¨—è™•ç†æ‰€æœ‰æŒ‰éˆ•é»æ“Š
                document.addEventListener('click', this.handleClick.bind(this));
                
                // è™•ç†è¡¨å–®æäº¤
                document.addEventListener('submit', this.handleSubmit.bind(this));
                
                // è™•ç†è¼¸å…¥äº‹ä»¶
                document.addEventListener('input', this.handleInput.bind(this));
                
                // è™•ç†è®Šæ›´äº‹ä»¶
                document.addEventListener('change', this.handleChange.bind(this));
                
                // è™•ç†éµç›¤äº‹ä»¶
                document.addEventListener('keydown', this.handleKeydown.bind(this));
                
                // è™•ç†æ¨¡æ…‹æ¡†èƒŒæ™¯é»æ“Š
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        app.ui.hideAllModals();
                    }
                });
            }

            // è™•ç†é»æ“Šäº‹ä»¶
            handleClick(e) {
                const action = e.target.dataset.action;
                if (!action) return;

                e.preventDefault();
                
                // é˜²æ­¢é‡è¤‡é»æ“Š
                if (e.target.disabled) return;
                
                try {
                    this.executeAction(action, e.target, e);
                } catch (error) {
                    console.error('åŸ·è¡Œå‹•ä½œå¤±æ•—:', action, error);
                    app.ui.showToast('æ“ä½œå¤±æ•—: ' + error.message, 'error');
                }
            }

            // è™•ç†è¡¨å–®æäº¤
            handleSubmit(e) {
                const form = e.target;
                const action = form.dataset.action;
                
                if (action) {
                    e.preventDefault();
                    try {
                        this.executeAction(action, form, e);
                    } catch (error) {
                        console.error('è¡¨å–®æäº¤å¤±æ•—:', action, error);
                        app.ui.showToast('æäº¤å¤±æ•—: ' + error.message, 'error');
                    }
                }
            }

            // è™•ç†è¼¸å…¥äº‹ä»¶
            handleInput(e) {
                const action = e.target.dataset.action;
                if (action) {
                    try {
                        this.executeAction(action, e.target, e);
                    } catch (error) {
                        console.error('è¼¸å…¥è™•ç†å¤±æ•—:', action, error);
                    }
                }
            }

            // è™•ç†è®Šæ›´äº‹ä»¶
            handleChange(e) {
                const action = e.target.dataset.action;
                if (action) {
                    try {
                        this.executeAction(action, e.target, e);
                    } catch (error) {
                        console.error('è®Šæ›´è™•ç†å¤±æ•—:', action, error);
                    }
                }
            }

            // è™•ç†éµç›¤äº‹ä»¶
            handleKeydown(e) {
                // ESC éµé—œé–‰æ¨¡æ…‹æ¡†
                if (e.key === 'Escape') {
                    app.ui.hideAllModals();
                }
                
                // Ctrl+S å„²å­˜
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    // è§¸ç™¼å„²å­˜å‹•ä½œ
                }
            }

            // åŸ·è¡Œå‹•ä½œ
            executeAction(action, element, event) {
                const handler = this.getHandler(action);
                if (handler) {
                    handler.call(app, element, event);
                } else {
                    console.warn('æœªæ‰¾åˆ°å‹•ä½œè™•ç†å™¨:', action);
                }
            }

            // è¨»å†Šå‹•ä½œè™•ç†å™¨
            registerHandler(action, handler) {
                this.handlers.set(action, handler);
            }

            // ç²å–å‹•ä½œè™•ç†å™¨
            getHandler(action) {
                return this.handlers.get(action);
            }

            // è¨»å†Šå¤šå€‹è™•ç†å™¨
            registerHandlers(handlers) {
                for (const [action, handler] of Object.entries(handlers)) {
                    this.registerHandler(action, handler);
                }
            }
        }

        // ===== ä¸»æ‡‰ç”¨ç¨‹å¼é¡ =====
        
        class SpiritualSurveyApp {
            constructor() {
                this.storage = new StorageManager();
                this.ui = new UIManager();
                this.events = new EventManager();
                
                // æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹
                this.state = {
                    currentEditingQuestion: null,
                    currentEditingCategory: null,
                    currentVersion: null,
                    surveyAnswers: {},
                    previewMode: 'BY_CATEGORY',
                    categories: [],
                    questions: [],
                    versions: [],
                    settings: {}
                };

                // è¨»å†Šäº‹ä»¶è™•ç†å™¨
                this.registerEventHandlers();
            }

            // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
            async init() {
                try {
                    this.ui.showLoading();
                    
                    // åˆå§‹åŒ–å„²å­˜ç³»çµ±
                    await this.storage.init();
                    
                    // è¼‰å…¥è³‡æ–™
                    await this.loadData();
                    
                    // æ¸²æŸ“ç•Œé¢
                    this.render();
                    
                    // è¨­ç½®æª¢æ¸¬æ—¥æœŸé è¨­å€¼
                    this.setDefaultTestDate();
                    
                    this.ui.hideLoading();
                    this.ui.showToast('ç³»çµ±åˆå§‹åŒ–å®Œæˆ', 'success');
                    
                } catch (error) {
                    console.error('æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å¤±æ•—:', error);
                    this.ui.hideLoading();
                    this.ui.showToast('ç³»çµ±åˆå§‹åŒ–å¤±æ•—: ' + error.message, 'error');
                }
            }

            // è¨»å†Šäº‹ä»¶è™•ç†å™¨
            registerEventHandlers() {
                this.events.registerHandlers({
                    // é é¢åˆ‡æ›
                    'show-page': (element) => {
                        const page = element.dataset.page;
                        this.ui.showPage(page);
                    },

                    // åˆ†é¡ç®¡ç†
                    'add-category': () => this.showCategoryModal(),
                    'edit-category': (element) => {
                        const categoryId = element.dataset.categoryId;
                        this.editCategory(categoryId);
                    },
                    'delete-category': (element) => {
                        const categoryId = element.dataset.categoryId;
                        this.deleteCategory(categoryId);
                    },
                    'save-category': () => this.saveCategoryFromModal(),

                    // é¡Œç›®ç®¡ç†
                    'add-question': () => this.showQuestionModal(),
                    'edit-question': (element) => {
                        const questionId = element.dataset.questionId;
                        this.editQuestion(questionId);
                    },
                    'delete-question': (element) => {
                        const questionId = element.dataset.questionId;
                        this.deleteQuestion(questionId);
                    },
                    'save-question': () => this.saveQuestionFromModal(),

                    // ç‰ˆæœ¬ç®¡ç†
                    'save-version': () => this.saveVersion(),
                    'load-version': () => this.showVersionModal(),
                    'load-specific-version': (element) => {
                        const versionId = element.dataset.versionId;
                        this.loadVersion(versionId);
                    },
                    'delete-version': (element) => {
                        const versionId = element.dataset.versionId;
                        this.deleteVersion(versionId);
                    },

                    // å•å·ç”Ÿæˆå’Œæäº¤
                    'generate-survey': () => this.generateSurvey(),
                    'submit-survey': () => this.submitSurvey(),
                    'restart-survey': () => location.reload(),

                    // è³‡æ–™ç®¡ç†
                    'export-library': () => this.exportLibrary(),
                    'import-library': () => this.showImportModal(),
                    'export-responses': () => this.exportResponses(),
                    'export-json': () => this.exportResultAsJSON(),
                    'export-csv': () => this.exportResultAsCSV(),

                    // æ¨¡æ…‹æ¡†ç®¡ç†
                    'close-modal': () => this.ui.hideAllModals(),

                    // æœå°‹å’Œç¯©é¸
                    'search-questions': Utils.debounce(() => this.renderQuestions(), CONFIG.DEBOUNCE_DELAY),
                    'filter-questions': () => this.renderQuestions(),

                    // é è¦½æ¨¡å¼åˆ‡æ›
                    'toggle-preview-mode': (element) => {
                        this.state.previewMode = element.checked ? 'RANDOM_ALL' : 'BY_CATEGORY';
                        this.storage.setSetting('previewMode', this.state.previewMode);
                        this.renderPreview();
                    },

                    // å•å·ä½œç­”
                    'select-answer': (element) => {
                        const questionId = element.dataset.questionId;
                        const value = parseInt(element.dataset.value);
                        this.selectAnswer(questionId, value);
                    }
                });
            }

            // è¼‰å…¥è³‡æ–™
            async loadData() {
                try {
                    this.state.categories = this.storage.getCategories();
                    this.state.questions = this.storage.getQuestions();
                    this.state.versions = this.storage.getVersions();
                    this.state.settings = this.storage.getSettings();
                    this.state.previewMode = this.state.settings.previewMode || 'BY_CATEGORY';
                } catch (error) {
                    console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', error);
                    throw error;
                }
            }

            // æ¸²æŸ“ç•Œé¢
            render() {
                try {
                    this.renderCategoryTree();
                    this.renderQuestions();
                    this.renderPreview();
                    this.renderVersions();
                    this.updateStats();
                } catch (error) {
                    console.error('æ¸²æŸ“ç•Œé¢å¤±æ•—:', error);
                    this.ui.showToast('ç•Œé¢æ¸²æŸ“å¤±æ•—', 'error');
                }
            }

            // æ¸²æŸ“åˆ†é¡æ¨¹
            renderCategoryTree() {
                const container = document.getElementById('category-tree');
                if (!container) return;

                const tree = this.buildCategoryTree();
                let html = '';

                Object.entries(CONFIG.LAYER_NAMES).forEach(([layerType, layerName]) => {
                    const categories = tree[layerType] || [];
                    
                    html += `
                        <div class="category-layer fade-in">
                            <div class="category-layer-header">
                                <h3>${layerName}</h3>
                                <button class="btn-icon tooltip" data-action="add-category" data-layer="${layerType}" data-tooltip="æ–°å¢åˆ†é¡">
                                    <span>+</span>
                                </button>
                            </div>
                            <div class="category-layer-content">
                                ${this.renderCategoryNodes(categories)}
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html || '<div class="empty-state"><div class="empty-state-icon">ğŸ“</div>å°šç„¡åˆ†é¡è³‡æ–™</div>';
            }

            // å»ºç«‹åˆ†é¡æ¨¹
            buildCategoryTree() {
                const tree = {};
                
                Object.values(CONFIG.LAYER_TYPES).forEach(layer => {
                    tree[layer] = this.state.categories
                        .filter(c => c.layer === layer && !c.parentId)
                        .sort((a, b) => a.order - b.order)
                        .map(category => ({
                            ...category,
                            children: this.getCategoryChildren(category.id)
                        }));
                });
                
                return tree;
            }

            // ç²å–å­åˆ†é¡
            getCategoryChildren(parentId) {
                return this.state.categories
                    .filter(c => c.parentId === parentId)
                    .sort((a, b) => a.order - b.order);
            }

            // æ¸²æŸ“åˆ†é¡ç¯€é»
            renderCategoryNodes(categories) {
                return categories.map(category => {
                    const questionCount = this.getCategoryQuestionCount(category.id);
                    const hasChildren = category.children && category.children.length > 0;
                    
                    return `
                        <div class="category-node">
                            <div class="category-item">
                                <span class="category-name">${Utils.sanitizeHtml(category.name)}</span>
                                <span class="question-count">${questionCount}</span>
                                <div class="category-actions">
                                    <button class="btn-icon tooltip" data-action="edit-category" data-category-id="${category.id}" data-tooltip="ç·¨è¼¯">
                                        <span>âœï¸</span>
                                    </button>
                                    <button class="btn-icon tooltip" data-action="delete-category" data-category-id="${category.id}" data-tooltip="åˆªé™¤">
                                        <span>ğŸ—‘ï¸</span>
                                    </button>
                                    ${category.layer === 'PRACTICES' ? `
                                        <button class="btn-icon tooltip" data-action="add-category" data-layer="${category.layer}" data-parent-id="${category.id}" data-tooltip="æ–°å¢å­åˆ†é¡">
                                            <span>+</span>
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                            ${hasChildren ? `
                                <div class="category-children">
                                    ${this.renderCategoryNodes(category.children)}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            }

            // è¨ˆç®—åˆ†é¡é¡Œç›®æ•¸é‡
            getCategoryQuestionCount(categoryId) {
                return this.state.questions.filter(q => q.categoryIds.includes(categoryId)).length;
            }

            // æ¸²æŸ“é¡Œç›®åˆ—è¡¨
            renderQuestions() {
                const container = document.getElementById('question-list');
                if (!container) return;

                let filteredQuestions = [...this.state.questions];

                // æœå°‹ç¯©é¸
                const searchTerm = document.getElementById('question-search')?.value.toLowerCase();
                if (searchTerm) {
                    filteredQuestions = filteredQuestions.filter(q => 
                        q.text.toLowerCase().includes(searchTerm)
                    );
                }

                // åˆ†é¡ç¯©é¸
                const categoryFilter = document.getElementById('category-filter')?.value;
                if (categoryFilter) {
                    filteredQuestions = filteredQuestions.filter(q => 
                        q.categoryIds.includes(categoryFilter)
                    );
                }

                // å®—æ•™æ€§ç¯©é¸
                const religiousFilter = document.getElementById('religious-filter')?.value;
                if (religiousFilter === 'religious') {
                    filteredQuestions = filteredQuestions.filter(q => q.isReligious);
                } else if (religiousFilter === 'non-religious') {
                    filteredQuestions = filteredQuestions.filter(q => !q.isReligious);
                }

                // æ’åº
                filteredQuestions.sort((a, b) => a.order - b.order);

                const html = filteredQuestions.map(question => {
                    const categoryNames = question.categoryIds
                        .map(id => {
                            const category = this.state.categories.find(c => c.id === id);
                            return category ? category.name : '';
                        })
                        .filter(name => name)
                        .join(', ');

                    return `
                        <div class="question-item fade-in" draggable="true" data-question-id="${question.id}">
                            <div class="question-content">
                                <div class="question-text">${Utils.sanitizeHtml(question.text)}</div>
                                <div class="question-meta">
                                    <span class="question-categories">${Utils.sanitizeHtml(categoryNames)}</span>
                                    ${question.isReligious ? '<span class="religious-tag">å®—æ•™æ€§</span>' : ''}
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-icon tooltip" data-action="edit-question" data-question-id="${question.id}" data-tooltip="ç·¨è¼¯">
                                    <span>âœï¸</span>
                                </button>
                                <button class="btn-icon tooltip" data-action="delete-question" data-question-id="${question.id}" data-tooltip="åˆªé™¤">
                                    <span>ğŸ—‘ï¸</span>
                                </button>
                                <span class="drag-handle tooltip" data-tooltip="æ‹–æ›³æ’åº">â‹®â‹®</span>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html || '<div class="empty-state"><div class="empty-state-icon">â“</div>æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„é¡Œç›®</div>';
                this.updateCategoryFilter();
            }

            // æ›´æ–°åˆ†é¡ç¯©é¸é¸é …
            updateCategoryFilter() {
                const select = document.getElementById('category-filter');
                if (!select) return;

                const currentValue = select.value;
                let html = '<option value="">æ‰€æœ‰åˆ†é¡</option>';
                
                Object.entries(CONFIG.LAYER_NAMES).forEach(([layerType, layerName]) => {
                    const categories = this.state.categories.filter(c => c.layer === layerType);
                    if (categories.length > 0) {
                        html += `<optgroup label="${layerName}">`;
                        categories.forEach(category => {
                            html += `<option value="${category.id}">${Utils.sanitizeHtml(category.name)}</option>`;
                        });
                        html += '</optgroup>';
                    }
                });

                select.innerHTML = html;
                select.value = currentValue;
            }

            // æ¸²æŸ“é è¦½
            renderPreview() {
                const container = document.getElementById('preview-pane');
                if (!container) return;

                let questions = [...this.state.questions];

                if (this.state.previewMode === 'RANDOM_ALL') {
                    questions = Utils.shuffleArray(questions);
                } else {
                    questions.sort((a, b) => a.order - b.order);
                }

                const html = `
                    <div class="preview-header">
                        <h3>å•å·é è¦½</h3>
                        <div class="preview-info">
                            <span>å…± ${questions.length} é¡Œ</span>
                            <span>æ¨¡å¼: ${this.state.previewMode === 'RANDOM_ALL' ? 'éš¨æ©Ÿ' : 'åˆ†é¡é †åº'}</span>
                        </div>
                    </div>
                    <div class="preview-intro">
                        ${CONFIG.SURVEY_INTRO_TEXT.replace(/\n/g, '<br>')}
                    </div>
                    <div class="preview-questions">
                        ${questions.map((question, index) => `
                            <div class="preview-question fade-in">
                                <div class="question-number">${index + 1}.</div>
                                <div class="question-text">${Utils.sanitizeHtml(question.text)}</div>
                                <div class="scale-options">
                                    ${CONFIG.SCALE_OPTIONS.map(option => `
                                        <label class="scale-option">
                                            <input type="radio" name="preview-q${question.id}" value="${option.value}" disabled>
                                            <span class="scale-label">${option.value}. ${option.label}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

                container.innerHTML = html;
            }

            // æ¸²æŸ“ç‰ˆæœ¬åˆ—è¡¨
            renderVersions() {
                const container = document.getElementById('version-list');
                if (!container) return;

                const versions = [...this.state.versions].sort((a, b) => 
                    new Date(b.createdAt) - new Date(a.createdAt)
                );

                const html = versions.map(version => `
                    <div class="version-item fade-in">
                        <div class="version-info">
                            <div class="version-name">${Utils.sanitizeHtml(version.name)}</div>
                            <div class="version-date">${Utils.formatDate(new Date(version.createdAt))}</div>
                        </div>
                        <div class="version-actions">
                            <button class="btn-small" data-action="load-specific-version" data-version-id="${version.id}">è¼‰å…¥</button>
                            <button class="btn-small btn-danger" data-action="delete-version" data-version-id="${version.id}">åˆªé™¤</button>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = html || '<div class="empty-state"><div class="empty-state-icon">ğŸ“‹</div>å°šç„¡å„²å­˜çš„ç‰ˆæœ¬</div>';
            }

            // æ›´æ–°çµ±è¨ˆ
            updateStats() {
                const stats = this.storage.getStats();
                const elements = {
                    'stats-categories': stats.categories.total,
                    'stats-questions': stats.questions.total,
                    'stats-versions': stats.versions.total,
                    'stats-responses': stats.responses.total
                };

                Object.entries(elements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                    }
                });
            }

            // é¡¯ç¤ºåˆ†é¡æ¨¡æ…‹æ¡†
            showCategoryModal(layer = null, parentId = null) {
                this.state.currentEditingCategory = null;
                
                const form = document.getElementById('category-form');
                if (form) {
                    form.reset();
                    this.ui.clearFormErrors('category-form');
                }
                
                const layerSelect = document.getElementById('category-layer');
                if (layerSelect) {
                    layerSelect.innerHTML = Object.entries(CONFIG.LAYER_NAMES)
                        .map(([value, label]) => `<option value="${value}">${label}</option>`)
                        .join('');
                    
                    if (layer) {
                        layerSelect.value = layer;
                        layerSelect.disabled = true;
                    } else {
                        layerSelect.disabled = false;
                    }
                }

                this.ui.showModal('category-modal');
            }

            // ç·¨è¼¯åˆ†é¡
            editCategory(categoryId) {
                const category = this.state.categories.find(c => c.id === categoryId);
                if (!category) {
                    this.ui.showToast('æ‰¾ä¸åˆ°æŒ‡å®šçš„åˆ†é¡', 'error');
                    return;
                }

                this.state.currentEditingCategory = category;
                
                document.getElementById('category-name').value = category.name;
                document.getElementById('category-layer').value = category.layer;
                document.getElementById('category-layer').disabled = true;

                this.ui.showModal('category-modal');
            }

            // å¾æ¨¡æ…‹æ¡†å„²å­˜åˆ†é¡
            async saveCategoryFromModal() {
                const isValid = this.ui.validateForm('category-form', {
                    name: {
                        required: true,
                        requiredMessage: 'è«‹è¼¸å…¥åˆ†é¡åç¨±',
                        validator: (value) => value.trim().length >= 2,
                        validatorMessage: 'åˆ†é¡åç¨±è‡³å°‘éœ€è¦2å€‹å­—å…ƒ'
                    },
                    layer: {
                        required: true,
                        requiredMessage: 'è«‹é¸æ“‡åˆ†é¡å±¤ç´š'
                    }
                });

                if (!isValid) return;

                try {
                    this.ui.showLoading();
                    
                    const form = document.getElementById('category-form');
                    const formData = new FormData(form);
                    
                    const categoryData = {
                        name: formData.get('name').trim(),
                        layer: formData.get('layer'),
                        parentId: formData.get('parent') || null
                    };

                    if (this.state.currentEditingCategory) {
                        await this.storage.updateCategory(this.state.currentEditingCategory.id, categoryData);
                        this.ui.showToast('åˆ†é¡å·²æ›´æ–°', 'success');
                    } else {
                        const newCategory = {
                            id: Utils.generateId(),
                            ...categoryData,
                            order: this.getNextCategoryOrder(categoryData.layer, categoryData.parentId)
                        };
                        
                        await this.storage.addCategory(newCategory);
                        this.ui.showToast('åˆ†é¡å·²æ–°å¢', 'success');
                    }

                    await this.loadData();
                    this.render();
                    this.ui.hideAllModals();

                } catch (error) {
                    console.error('å„²å­˜åˆ†é¡å¤±æ•—:', error);
                    this.ui.showToast('å„²å­˜åˆ†é¡å¤±æ•—: ' + error.message, 'error');
                } finally {
                    this.ui.hideLoading();
                }
            }

            // åˆªé™¤åˆ†é¡
            async deleteCategory(categoryId) {
                const category = this.state.categories.find(c => c.id === categoryId);
                if (!category) {
                    this.ui.showToast('æ‰¾ä¸åˆ°æŒ‡å®šçš„åˆ†é¡', 'error');
                    return;
                }

                const relatedQuestions = this.state.questions.filter(q => q.categoryIds.includes(categoryId));
                
                let confirmMessage = `ç¢ºå®šè¦åˆªé™¤åˆ†é¡ã€Œ${category.name}ã€å—ï¼Ÿ`;
                if (relatedQuestions.length > 0) {
                    confirmMessage += `\n\næ­¤åˆ†é¡è¢« ${relatedQuestions.length} å€‹é¡Œç›®ä½¿ç”¨ï¼Œåˆªé™¤å¾Œé€™äº›é¡Œç›®å°‡å¤±å»æ­¤åˆ†é¡æ¨™è¨˜ã€‚`;
                }

                const confirmed = await this.ui.showConfirm(confirmMessage);
                if (!confirmed) return;

                try {
                    this.ui.showLoading();
                    
                    // æ›´æ–°ç›¸é—œé¡Œç›®
                    for (const question of relatedQuestions) {
                        question.categoryIds = question.categoryIds.filter(id => id !== categoryId);
                        await this.storage.updateQuestion(question.id, { categoryIds: question.categoryIds });
                    }

                    await this.storage.deleteCategory(categoryId);
                    await this.loadData();
                    this.render();
                    
                    this.ui.showToast('åˆ†é¡å·²åˆªé™¤', 'success');

                } catch (error) {
                    console.error('åˆªé™¤åˆ†é¡å¤±æ•—:', error);
                    this.ui.showToast('åˆªé™¤åˆ†é¡å¤±æ•—: ' + error.message, 'error');
                } finally {
                    this.ui.hideLoading();
                }
            }

            // ç²å–ä¸‹ä¸€å€‹åˆ†é¡æ’åºè™Ÿ
            getNextCategoryOrder(layer, parentId = null) {
                const siblings = this.state.categories.filter(c => 
                    c.layer === layer && c.parentId === parentId
                );
                return siblings.length > 0 ? Math.max(...siblings.map(c => c.order)) + 1 : 1;
            }

            // é¡¯ç¤ºé¡Œç›®æ¨¡æ…‹æ¡†
            showQuestionModal() {
                this.state.currentEditingQuestion = null;
                
                const form = document.getElementById('question-form');
                if (form) {
                    form.reset();
                    this.ui.clearFormErrors('question-form');
                }
                
                this.updateQuestionCategoryOptions();
                this.ui.showModal('question-modal');
            }

            // ç·¨è¼¯é¡Œç›®
            editQuestion(questionId) {
                const question = this.state.questions.find(q => q.id === questionId);
                if (!question) {
                    this.ui.showToast('æ‰¾ä¸åˆ°æŒ‡å®šçš„é¡Œç›®', 'error');
                    return;
                }

                this.state.currentEditingQuestion = question;
                
                document.getElementById('q-text').value = question.text;
                document.getElementById('q-is-religious').checked = question.isReligious || false;
                
                this.updateQuestionCategoryOptions();
                
                // è¨­ç½®å·²é¸æ“‡çš„åˆ†é¡
                question.categoryIds.forEach(categoryId => {
                    const checkbox = document.querySelector(`input[name="categories"][value="${categoryId}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });

                this.ui.showModal('question-modal');
            }

            // æ›´æ–°é¡Œç›®åˆ†é¡é¸é …
            updateQuestionCategoryOptions() {
                const container = document.getElementById('question-categories');
                if (!container) return;

                let html = '';
                
                Object.entries(CONFIG.LAYER_NAMES).forEach(([layerType, layerName]) => {
                    const categories = this.state.categories.filter(c => c.layer === layerType);
                    if (categories.length > 0) {
                        html += `
                            <div class="category-group">
                                <h4>${layerName}</h4>
                                <div class="checkbox-group">
                                    ${categories.map(category => `
                                        <label class="checkbox-label">
                                            <input type="checkbox" name="categories" value="${category.id}">
                                            <span>${Utils.sanitizeHtml(category.name)}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }
                });

                container.innerHTML = html;
            }

            // å¾æ¨¡æ…‹æ¡†å„²å­˜é¡Œç›®
            async saveQuestionFromModal() {
                // è‡ªå®šç¾©é©—è­‰åˆ†é¡é¸æ“‡
                const selectedCategories = document.querySelectorAll('input[name="categories"]:checked');
                
                const isValid = this.ui.validateForm('question-form', {
                    text: {
                        required: true,
                        requiredMessage: 'è«‹è¼¸å…¥é¡Œç›®å…§å®¹',
                        validator: (value) => value.trim().length >= 5,
                        validatorMessage: 'é¡Œç›®å…§å®¹è‡³å°‘éœ€è¦5å€‹å­—å…ƒ'
                    }
                });

                if (selectedCategories.length === 0) {
                    this.ui.showFormError('question-categories', 'è«‹è‡³å°‘é¸æ“‡ä¸€å€‹åˆ†é¡');
                    return;
                }

                if (!isValid) return;

                try {
                    this.ui.showLoading();
                    
                    const form = document.getElementById('question-form');
                    const formData = new FormData(form);
                    
                    const questionData = {
                        text: formData.get('text').trim(),
                        categoryIds: Array.from(selectedCategories).map(cb => cb.value),
                        isReligious: formData.has('isReligious')
                    };

                    if (this.state.currentEditingQuestion) {
                        await this.storage.updateQuestion(this.state.currentEditingQuestion.id, questionData);
                        this.ui.showToast('é¡Œç›®å·²æ›´æ–°', 'success');
                    } else {
                        const newQuestion = {
                            id: Utils.generateId(),
                            ...questionData,
                            order: this.getNextQuestionOrder()
                        };
                        
                        await this.storage.addQuestion(newQuestion);
                        this.ui.showToast('é¡Œç›®å·²æ–°å¢', 'success');
                    }

                    await this.loadData();
                    this.render();
                    this.ui.hideAllModals();

                } catch (error) {
                    console.error('å„²å­˜é¡Œç›®å¤±æ•—:', error);
                    this.ui.showToast('å„²å­˜é¡Œç›®å¤±æ•—: ' + error.message, 'error');
                } finally {
                    this.ui.hideLoading();
                }
            }

            // åˆªé™¤é¡Œç›®
            async deleteQuestion(questionId) {
                const question = this.state.questions.find(q => q.id === questionId);
                if (!question) {
                    this.ui.showToast('æ‰¾ä¸åˆ°æŒ‡å®šçš„é¡Œç›®', 'error');
                    return;
                }

                const confirmed = await this.ui.showConfirm(`ç¢ºå®šè¦åˆªé™¤é¡Œç›®ã€Œ${question.text}ã€å—ï¼Ÿ`);
                if (!confirmed) return;

                try {
                    this.ui.showLoading();
                    
                    await this.storage.deleteQuestion(questionId);
                    await this.loadData();
                    this.render();
                    
                    this.ui.showToast('é¡Œç›®å·²åˆªé™¤', 'success');

                } catch (error) {
                    console.error('åˆªé™¤é¡Œç›®å¤±æ•—:', error);
                    this.ui.showToast('åˆªé™¤é¡Œç›®å¤±æ•—: ' + error.message, 'error');
                } finally {
                    this.ui.hideLoading();
                }
            }

            // ç²å–ä¸‹ä¸€å€‹é¡Œç›®æ’åºè™Ÿ
            getNextQuestionOrder() {
                return this.state.questions.length > 0 ? Math.max(...this.state.questions.map(q => q.order)) + 1 : 1;
            }

            // å„²å­˜ç‰ˆæœ¬
            async saveVersion() {
                if (this.state.questions.length === 0) {
                    this.ui.showToast('è«‹å…ˆæ–°å¢é¡Œç›®å†å„²å­˜ç‰ˆæœ¬', 'warning');
                    return;
                }

                const versionName = await this.ui.showPrompt(
                    'è«‹è¼¸å…¥ç‰ˆæœ¬åç¨±:',
                    `ç‰ˆæœ¬ ${Utils.formatDate(new Date(), 'YYYY-MM-DD HH:mm')}`
                );
                
                if (!versionName) return;

                try {
                    this.ui.showLoading();
                    
                    const settings = {
                        orderMode: this.state.previewMode,
                        includeReligious: 'ALL'
                    };
                    
                    const version = await this.storage.createVersion(versionName, settings);
                    
                    await this.loadData();
                    this.renderVersions();
                    
                    this.ui.showToast(`ç‰ˆæœ¬ã€Œ${version.name}ã€å·²å„²å­˜`, 'success');
                    
                } catch (error) {
                    console.error('å„²å­˜ç‰ˆæœ¬å¤±æ•—:', error);
                    this.ui.showToast('å„²å­˜ç‰ˆæœ¬å¤±æ•—: ' + error.message, 'error');
                } finally {
                    this.ui.hideLoading();
                }
            }

            // é¡¯ç¤ºç‰ˆæœ¬æ¨¡æ…‹æ¡†
            showVersionModal() {
                this.renderVersionsInModal();
                this.ui.showModal('version-modal');
            }

            // åœ¨æ¨¡æ…‹æ¡†ä¸­æ¸²æŸ“ç‰ˆæœ¬åˆ—è¡¨
            renderVersionsInModal() {
                const container = document.getElementById('version-list-modal');
                if (!container) return;

                const versions = [...this.state.versions].sort((a, b) => 
                    new Date(b.createdAt) - new Date(a.createdAt)
                );

                const html = versions.map(version => `
                    <div class="version-item">
                        <div class="version-info">
                            <div class="version-name">${Utils.sanitizeHtml(version.name)}</div>
                            <div class="version-date">${Utils.formatDate(new Date(version.createdAt))}</div>
                            <div style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">
                                ${version.snapshot.questions.length} é¡Œç›®, ${version.snapshot.categories.length} åˆ†é¡
                            </div>
                        </div>
                        <div class="version-actions">
                            <button class="btn-small" data-action="load-specific-version" data-version-id="${version.id}">è¼‰å…¥</button>
                            <button class="btn-small btn-danger" data-action="delete-version" data-version-id="${version.id}">åˆªé™¤</button>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = html || '<div class="empty-state"><div class="empty-state-icon">ğŸ“‹</div>å°šç„¡å„²å­˜çš„ç‰ˆæœ¬</div>';
            }

            // è¼‰å…¥ç‰ˆæœ¬
            async loadVersion(versionId) {
                const confirmed = await this.ui.showConfirm('è¼‰å…¥ç‰ˆæœ¬å°‡è¦†è“‹ç•¶å‰çš„åˆ†é¡å’Œé¡Œç›®ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ');
                if (!confirmed) return;

                try {
                    this.ui.showLoading();
                    
                    const version = await this.storage.loadVersion(versionId);
                    
                    await this.loadData();
                    this.render();
                    this.ui.hideAllModals();
                    
                    this.ui.showToast(`ç‰ˆæœ¬ã€Œ${version.name}ã€å·²è¼‰å…¥`, 'success');
                    
                } catch (error) {
                    console.error('è¼‰å…¥ç‰ˆæœ¬å¤±æ•—:', error);
                    this.ui.showToast('è¼‰å…¥ç‰ˆæœ¬å¤±æ•—: ' + error.message, 'error');
                } finally {
                    this.ui.hideLoading();
                }
            }

            // åˆªé™¤ç‰ˆæœ¬
            async deleteVersion(versionId) {
                const version = this.storage.getVersion(versionId);
                if (!version) {
                    this.ui.showToast('æ‰¾ä¸åˆ°æŒ‡å®šçš„ç‰ˆæœ¬', 'error');
                    return;
                }

                const confirmed = await this.ui.showConfirm(`ç¢ºå®šè¦åˆªé™¤ç‰ˆæœ¬ã€Œ${version.name}ã€å—ï¼Ÿ`);
                if (!confirmed) return;

                try {
                    this.ui.showLoading();
                    
                    await this.storage.deleteVersion(versionId);
                    await this.loadData();
                    this.renderVersions();
                    this.renderVersionsInModal();
                    
                    this.ui.showToast('ç‰ˆæœ¬å·²åˆªé™¤', 'success');

                } catch (error) {
                    console.error('åˆªé™¤ç‰ˆæœ¬å¤±æ•—:', error);
                    this.ui.showToast('åˆªé™¤ç‰ˆæœ¬å¤±æ•—: ' + error.message, 'error');
                } finally {
                    this.ui.hideLoading();
                }
            }

            // ç”Ÿæˆå•å·
            async generateSurvey() {
                if (this.state.questions.length === 0) {
                    this.ui.showToast('è«‹å…ˆæ–°å¢é¡Œç›®', 'error');
                    return;
                }

                try {
                    this.ui.showLoading();
                    
                    const versionName = `å•å·ç‰ˆæœ¬ ${Utils.formatDate(new Date(), 'YYYY-MM-DD HH:mm:ss')}`;
                    const settings = {
                        orderMode: this.state.previewMode,
                        includeReligious: 'ALL'
                    };
                    
                    const version = await this.storage.createVersion(versionName, settings);
                    this.state.currentVersion = version;
                    
                    this.ui.showPage('survey');
                    this.ui.showToast('å•å·å·²ç”Ÿæˆ', 'success');
                    
                } catch (error) {
                    console.error('ç”Ÿæˆå•å·å¤±æ•—:', error);
                    this.ui.showToast('ç”Ÿæˆå•å·å¤±æ•—: ' + error.message, 'error');
                } finally {
                    this.ui.hideLoading();
                }
            }

            // åŒ¯å‡ºé¡Œåº«
            exportLibrary() {
                try {
                    const data = this.storage.exportLibrary();
                    const filename = `spiritual-survey-library-${Utils.formatDate(new Date(), 'YYYY-MM-DD')}.json`;
                    
                    Utils.downloadFile(JSON.stringify(data, null, 2), filename, 'application/json');
                    this.ui.showToast('é¡Œåº«å·²åŒ¯å‡º', 'success');
                    
                } catch (error) {
                    console.error('åŒ¯å‡ºé¡Œåº«å¤±æ•—:', error);
                    this.ui.showToast('åŒ¯å‡ºé¡Œåº«å¤±æ•—: ' + error.message, 'error');
                }
            }

            // é¡¯ç¤ºåŒ¯å…¥æ¨¡æ…‹æ¡†
            showImportModal() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.importLibrary(file);
                    }
                };
                
                input.click();
            }

            // åŒ¯å…¥é¡Œåº«
            async importLibrary(file) {
                try {
                    this.ui.showLoading();
                    
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    const confirmed = await this.ui.showConfirm('åŒ¯å…¥å°‡è¦†è“‹ç¾æœ‰çš„åˆ†é¡å’Œé¡Œç›®ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ');
                    if (!confirmed) return;
                    
                    await this.storage.importLibrary(data);
                    
                    await this.loadData();
                    this.render();
                    
                    this.ui.showToast('é¡Œåº«å·²åŒ¯å…¥', 'success');
                    
                } catch (error) {
                    console.error('åŒ¯å…¥é¡Œåº«å¤±æ•—:', error);
                    this.ui.showToast('åŒ¯å…¥é¡Œåº«å¤±æ•—: ' + error.message, 'error');
                } finally {
                    this.ui.hideLoading();
                }
            }

            // åŒ¯å‡ºå›è¦†
            exportResponses() {
                try {
                    const responses = this.storage.getResponses();
                    
                    if (responses.length === 0) {
                        this.ui.showToast('æ²’æœ‰å›è¦†è³‡æ–™å¯åŒ¯å‡º', 'warning');
                        return;
                    }
                    
                    const filename = `spiritual-survey-responses-${Utils.formatDate(new Date(), 'YYYY-MM-DD')}.json`;
                    Utils.downloadFile(JSON.stringify(responses, null, 2), filename, 'application/json');
                    
                    this.ui.showToast('å›è¦†è³‡æ–™å·²åŒ¯å‡º', 'success');
                    
                } catch (error) {
                    console.error('åŒ¯å‡ºå›è¦†å¤±æ•—:', error);
                    this.ui.showToast('åŒ¯å‡ºå›è¦†å¤±æ•—: ' + error.message, 'error');
                }
            }

            // è¨­ç½®é è¨­æª¢æ¸¬æ—¥æœŸ
            setDefaultTestDate() {
                const testDateInput = document.querySelector('input[name="testDate"]');
                if (testDateInput) {
                    testDateInput.value = Utils.formatDate(new Date(), 'YYYY-MM-DD');
                }
            }

            // ===== å•å·ä½œç­”åŠŸèƒ½ =====

            // åˆå§‹åŒ–å•å·
            initSurvey() {
                // ç²å–ç‰ˆæœ¬ ID
                const urlParams = new URLSearchParams(window.location.search);
                const versionId = urlParams.get('versionId');
                
                if (versionId) {
                    this.state.currentVersion = this.storage.getVersion(versionId);
                }
                
                if (!this.state.currentVersion) {
                    // ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬æˆ–å»ºç«‹è‡¨æ™‚ç‰ˆæœ¬
                    const versions = this.storage.getVersions();
                    if (versions.length > 0) {
                        this.state.currentVersion = versions[versions.length - 1];
                    } else {
                        // å»ºç«‹è‡¨æ™‚ç‰ˆæœ¬
                        this.state.currentVersion = {
                            id: 'temp',
                            name: 'è‡¨æ™‚ç‰ˆæœ¬',
                            settings: { orderMode: 'BY_CATEGORY' },
                            snapshot: {
                                categories: this.storage.getCategories(),
                                questions: this.storage.getQuestions()
                            }
                        };
                    }
                }

                this.renderSurvey();
            }

            // æ¸²æŸ“å•å·
            renderSurvey() {
                // é¡¯ç¤ºå¼•å°èª
                const introElement = document.getElementById('intro-text');
                if (introElement) {
                    introElement.innerHTML = CONFIG.SURVEY_INTRO_TEXT.replace(/\n/g, '<br>');
                }
                
                // è¨­å®šæª¢æ¸¬æ—¥æœŸé è¨­å€¼
                this.setDefaultTestDate();

                // æ¸²æŸ“é¡Œç›®
                this.renderSurveyQuestions();
            }

            // æ¸²æŸ“å•å·é¡Œç›®
            renderSurveyQuestions() {
                const container = document.getElementById('survey-questions');
                if (!container || !this.state.currentVersion) return;

                let questions = [...this.state.currentVersion.snapshot.questions];

                // æ ¹æ“šè¨­å®šæ’åº
                if (this.state.currentVersion.settings.orderMode === 'RANDOM_ALL') {
                    questions = Utils.shuffleArray(questions);
                } else {
                    questions.sort((a, b) => a.order - b.order);
                }

                const html = questions.map((question, index) => `
                    <div class="survey-question fade-in">
                        <div class="survey-question-number">${index + 1}.</div>
                        <div class="survey-question-text">${Utils.sanitizeHtml(question.text)}</div>
                        <div class="survey-scale">
                            ${CONFIG.SCALE_OPTIONS.map(option => `
                                <div class="survey-scale-option" data-action="select-answer" data-question-id="${question.id}" data-value="${option.value}">
                                    <div class="survey-scale-value">${option.value}</div>
                                    <div class="survey-scale-label">${option.label}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');

                container.innerHTML = html;
                
                // é‡ç½®ç­”æ¡ˆ
                this.state.surveyAnswers = {};
                this.updateProgress();
            }

            // é¸æ“‡ç­”æ¡ˆ
            selectAnswer(questionId, value) {
                this.state.surveyAnswers[questionId] = value;
                
                // æ›´æ–° UI
                document.querySelectorAll(`[data-question-id="${questionId}"]`).forEach(option => {
                    option.classList.remove('selected');
                });
                
                event.target.closest('.survey-scale-option').classList.add('selected');
                
                this.updateProgress();
            }

            // æ›´æ–°é€²åº¦
            updateProgress() {
                const totalQuestions = this.state.currentVersion.snapshot.questions.length;
                const answeredQuestions = Object.keys(this.state.surveyAnswers).length;
                const progress = (answeredQuestions / totalQuestions) * 100;
                
                const progressFill = document.getElementById('progress-fill');
                if (progressFill) {
                    progressFill.style.width = `${progress}%`;
                }
                
                // é¡¯ç¤ºå€‹äººè³‡æ–™è¡¨å–®
                const profileForm = document.getElementById('profile-form');
                if (answeredQuestions === totalQuestions && profileForm) {
                    profileForm.classList.remove('hidden');
                    profileForm.scrollIntoView({ behavior: 'smooth' });
                }
            }

            // æäº¤å•å·
            async submitSurvey() {
                try {
                    // æª¢æŸ¥æ˜¯å¦å®Œæˆä½œç­”
                    const totalQuestions = this.state.currentVersion.snapshot.questions.length;
                    const answeredQuestions = Object.keys(this.state.surveyAnswers).length;
                    
                    if (answeredQuestions < totalQuestions) {
                        this.ui.showToast('è«‹å®Œæˆæ‰€æœ‰é¡Œç›®', 'error');
                        return;
                    }

                    // é©—è­‰å€‹äººè³‡æ–™è¡¨å–®
                    const isValid = this.ui.validateForm('profile-form', {
                        name: { required: true, requiredMessage: 'è«‹è¼¸å…¥å§“å' },
                        birth: { required: true, requiredMessage: 'è«‹é¸æ“‡ç”Ÿæ—¥' },
                        gender: { required: true, requiredMessage: 'è«‹é¸æ“‡æ€§åˆ¥' },
                        nationality: { required: true, requiredMessage: 'è«‹è¼¸å…¥åœ‹ç±' },
                        city: { required: true, requiredMessage: 'è«‹è¼¸å…¥å±…ä½åŸå¸‚' },
                        profession: { required: true, requiredMessage: 'è«‹è¼¸å…¥è·æ¥­' },
                        education: { required: true, requiredMessage: 'è«‹é¸æ“‡æ•™è‚²ç¨‹åº¦' },
                        marital: { required: true, requiredMessage: 'è«‹é¸æ“‡å©šå§»ç‹€æ³' },
                        religion: { required: true, requiredMessage: 'è«‹é¸æ“‡å®—æ•™ä¿¡ä»°' },
                        living: { required: true, requiredMessage: 'è«‹é¸æ“‡å±…ä½ç‹€æ³' },
                        testDate: { required: true, requiredMessage: 'è«‹é¸æ“‡æª¢æ¸¬æ—¥æœŸ' }
                    });

                    if (!isValid) {
                        this.ui.showToast('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½', 'error');
                        return;
                    }

                    this.ui.showLoading();

                    // æ”¶é›†å€‹äººè³‡æ–™
                    const profileForm = document.getElementById('profile-form');
                    const formData = new FormData(profileForm);
                    const demographics = {};
                    
                    for (let [key, value] of formData.entries()) {
                        demographics[key] = value.trim();
                    }

                    // å»ºç«‹å›è¦†è¨˜éŒ„
                    const response = {
                        id: Utils.generateId(),
                        versionId: this.state.currentVersion.id,
                        answers: Object.entries(this.state.surveyAnswers).map(([questionId, value]) => ({
                            questionId,
                            value
                        })),
                        demographics,
                        createdAt: new Date().toISOString()
                    };

                    // è¨ˆç®—åˆ†æçµæœ
                    const analysis = this.calculateAnalysis(response);
                    response.aggregates = analysis;

                    // å„²å­˜å›è¦†
                    await this.storage.saveResponse(response);

                    // é¡¯ç¤ºçµæœ
                    this.displayResults(response);
                    
                    this.ui.showToast('å•å·æäº¤æˆåŠŸ', 'success');

                } catch (error) {
                    console.error('æäº¤å•å·å¤±æ•—:', error);
                    this.ui.showToast('æäº¤å•å·å¤±æ•—: ' + error.message, 'error');
                } finally {
                    this.ui.hideLoading();
                }
            }

            // è¨ˆç®—åˆ†æçµæœ
            calculateAnalysis(response) {
                const categories = this.state.currentVersion.snapshot.categories;
                const questions = this.state.currentVersion.snapshot.questions;
                const answers = response.answers;

                const analysis = {
                    byDimension: {},
                    overall: 0
                };

                // è¨ˆç®—å„ç¶­åº¦å¹³å‡åˆ†
                const dimensionGroups = {
                    facets: categories.filter(c => c.layer === 'FACETS_7'),
                    indicators: categories.filter(c => c.layer === 'INDICATORS_10'),
                    principles: categories.filter(c => c.layer === 'PRINCIPLES_7')
                };

                Object.entries(dimensionGroups).forEach(([groupName, groupCategories]) => {
                    groupCategories.forEach(category => {
                        const categoryQuestions = questions.filter(q => 
                            q.categoryIds.includes(category.id)
                        );
                        
                        if (categoryQuestions.length > 0) {
                            const categoryAnswers = answers.filter(a => 
                                categoryQuestions.some(q => q.id === a.questionId)
                            );
                            
                            if (categoryAnswers.length > 0) {
                                const sum = categoryAnswers.reduce((total, answer) => total + answer.value, 0);
                                analysis.byDimension[category.name] = sum / categoryAnswers.length;
                            }
                        }
                    });
                });

                // è¨ˆç®—ç¸½å¹³å‡åˆ†
                const allScores = Object.values(analysis.byDimension);
                if (allScores.length > 0) {
                    analysis.overall = allScores.reduce((sum, score) => sum + score, 0) / allScores.length;
                }

                return analysis;
            }

            // é¡¯ç¤ºçµæœ
            displayResults(response) {
                const resultPanel = document.getElementById('result-panel');
                if (resultPanel) {
                    resultPanel.classList.remove('hidden');

                    // æ¸²æŸ“å„ç¶­åº¦åˆ†æ•¸
                    this.renderDimensionScores(response.aggregates);
                    
                    // ç¹ªè£½åœ–è¡¨
                    this.drawRadarChart(response.aggregates);
                    
                    // é¡¯ç¤ºå»ºè­°
                    this.renderSuggestions(response.aggregates);
                    
                    // å„²å­˜ç•¶å‰çµæœä¾›åŒ¯å‡ºä½¿ç”¨
                    this.state.currentResult = response;
                    
                    // æ»¾å‹•åˆ°çµæœå€åŸŸ
                    resultPanel.scrollIntoView({ behavior: 'smooth' });
                }
            }

            // æ¸²æŸ“ç¶­åº¦åˆ†æ•¸
            renderDimensionScores(aggregates) {
                const categories = this.state.currentVersion.snapshot.categories;
                
                // ä¸ƒé¢å‘
                const facetsContainer = document.getElementById('facets-scores');
                if (facetsContainer) {
                    const facets = categories.filter(c => c.layer === 'FACETS_7');
                    facetsContainer.innerHTML = facets.map(facet => {
                        const score = aggregates.byDimension[facet.name] || 0;
                        return `
                            <div class="dimension-score">
                                <span class="dimension-name">${Utils.sanitizeHtml(facet.name)}</span>
                                <span class="dimension-value">${score.toFixed(1)}</span>
                            </div>
                        `;
                    }).join('');
                }

                // åæŒ‡æ¨™
                const indicatorsContainer = document.getElementById('indicators-scores');
                if (indicatorsContainer) {
                    const indicators = categories.filter(c => c.layer === 'INDICATORS_10');
                    indicatorsContainer.innerHTML = indicators.map(indicator => {
                        const score = aggregates.byDimension[indicator.name] || 0;
                        return `
                            <div class="dimension-score">
                                <span class="dimension-name">${Utils.sanitizeHtml(indicator.name)}</span>
                                <span class="dimension-value">${score > 0 ? score.toFixed(1) : 'æœªè©•'}</span>
                            </div>
                        `;
                    }).join('');
                }

                // ä¸ƒåŸå‰‡
                const principlesContainer = document.getElementById('principles-scores');
                if (principlesContainer) {
                    const principles = categories.filter(c => c.layer === 'PRINCIPLES_7');
                    principlesContainer.innerHTML = principles.map(principle => {
                        const score = aggregates.byDimension[principle.name] || 0;
                        return `
                            <div class="dimension-score">
                                <span class="dimension-name">${Utils.sanitizeHtml(principle.name)}</span>
                                <span class="dimension-value">${score.toFixed(1)}</span>
                            </div>
                        `;
                    }).join('');
                }
            }

            // ç¹ªè£½é›·é”åœ–
            drawRadarChart(aggregates) {
                const canvas = document.getElementById('radar-chart');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                
                // è¨­å®š canvas å°ºå¯¸
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = Math.min(centerX, centerY) - 60;
                
                // æ¸…é™¤ç•«å¸ƒ
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // ç²å–ä¸ƒé¢å‘è³‡æ–™
                const categories = this.state.currentVersion.snapshot.categories.filter(c => c.layer === 'FACETS_7');
                const data = categories.map(category => ({
                    label: category.name,
                    value: aggregates.byDimension[category.name] || 0
                }));
                
                const angleStep = (2 * Math.PI) / data.length;
                
                // ç¹ªè£½èƒŒæ™¯ç¶²æ ¼
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 1;
                
                for (let i = 1; i <= 6; i++) {
                    ctx.beginPath();
                    const r = (radius * i) / 6;
                    ctx.arc(centerX, centerY, r, 0, 2 * Math.PI);
                    ctx.stroke();
                    
                    // ç¹ªè£½åˆ†æ•¸æ¨™ç±¤
                    ctx.fillStyle = '#9ca3af';
                    ctx.font = '10px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(i.toString(), centerX + r - 10, centerY - 5);
                }
                
                // ç¹ªè£½è»¸ç·šå’Œæ¨™ç±¤
                data.forEach((item, index) => {
                    const angle = index * angleStep - Math.PI / 2;
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    // è»¸ç·š
                    ctx.strokeStyle = '#e5e7eb';
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                    
                    // æ¨™ç±¤
                    ctx.fillStyle = '#374151';
                    ctx.font = '12px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    const labelX = centerX + Math.cos(angle) * (radius + 30);
                    const labelY = centerY + Math.sin(angle) * (radius + 30);
                    
                    // åˆ†è¡Œé¡¯ç¤ºé•·æ¨™ç±¤
                    const words = item.label.split('');
                    if (words.length > 4) {
                        const line1 = words.slice(0, 4).join('');
                        const line2 = words.slice(4).join('');
                        ctx.fillText(line1, labelX, labelY - 8);
                        ctx.fillText(line2, labelX, labelY + 8);
                    } else {
                        ctx.fillText(item.label, labelX, labelY);
                    }
                });
                
                // ç¹ªè£½æ•¸æ“šå¤šé‚Šå½¢
                ctx.strokeStyle = '#2563eb';
                ctx.fillStyle = 'rgba(37, 99, 235, 0.2)';
                ctx.lineWidth = 3;
                
                ctx.beginPath();
                data.forEach((item, index) => {
                    const angle = index * angleStep - Math.PI / 2;
                    const r = (radius * item.value) / 6;
                    const x = centerX + Math.cos(angle) * r;
                    const y = centerY + Math.sin(angle) * r;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
                
                // ç¹ªè£½æ•¸æ“šé»
                ctx.fillStyle = '#2563eb';
                data.forEach((item, index) => {
                    const angle = index * angleStep - Math.PI / 2;
                    const r = (radius * item.value) / 6;
                    const x = centerX + Math.cos(angle) * r;
                    const y = centerY + Math.sin(angle) * r;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 5, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    // é¡¯ç¤ºåˆ†æ•¸
                    ctx.fillStyle = '#1f2937';
                    ctx.font = 'bold 10px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(item.value.toFixed(1), x, y - 10);
                });
            }

            // æ¸²æŸ“å»ºè­°
            renderSuggestions(aggregates) {
                const container = document.getElementById('suggestions-content');
                if (!container) return;
                
                const suggestions = [];
                
                Object.entries(aggregates.byDimension).forEach(([dimension, score]) => {
                    let suggestion = '';
                    
                    if (score >= 4.5) {
                        suggestion = `æ‚¨åœ¨ã€Œ${dimension}ã€æ–¹é¢è¡¨ç¾å„ªè‰¯ï¼Œå»ºè­°ç¹¼çºŒä¿æŒä¸¦å¯è€ƒæ…®å¼•å°ä»–äººã€‚`;
                    } else if (score >= 3.0) {
                        suggestion = `æ‚¨åœ¨ã€Œ${dimension}ã€æ–¹é¢å…·å‚™åŸºç¤ï¼Œå¯é€²ä¸€æ­¥åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ç·´ç¿’ç›¸é—œåŸå‰‡ã€‚`;
                    } else {
                        suggestion = `å»ºè­°åŠ å¼·ã€Œ${dimension}ã€æ–¹é¢çš„ä¿®é¤Šï¼Œå¾æ—¥å¸¸è¦ºå¯Ÿé–‹å§‹ï¼Œé€éå…·é«”è¡Œå‹•æå‡ã€‚`;
                    }
                    
                    suggestions.push({ dimension, suggestion, score });
                });
                
                // æŒ‰åˆ†æ•¸æ’åºï¼Œä½åˆ†å„ªå…ˆé¡¯ç¤º
                suggestions.sort((a, b) => a.score - b.score);
                
                container.innerHTML = suggestions.map(item => `
                    <div class="suggestion-item fade-in">
                        <div class="suggestion-dimension">${Utils.sanitizeHtml(item.dimension)} (${item.score.toFixed(1)}åˆ†)</div>
                        <div class="suggestion-text">${Utils.sanitizeHtml(item.suggestion)}</div>
                    </div>
                `).join('');
            }

            // åŒ¯å‡ºçµæœç‚º JSON
            exportResultAsJSON() {
                if (!this.state.currentResult) {
                    this.ui.showToast('æ²’æœ‰çµæœè³‡æ–™å¯åŒ¯å‡º', 'warning');
                    return;
                }

                try {
                    const filename = `spiritual-survey-result-${Utils.formatDate(new Date(), 'YYYY-MM-DD-HHmmss')}.json`;
                    Utils.downloadFile(JSON.stringify(this.state.currentResult, null, 2), filename, 'application/json');
                    this.ui.showToast('çµæœå·²åŒ¯å‡ºç‚º JSON', 'success');
                } catch (error) {
                    console.error('åŒ¯å‡º JSON å¤±æ•—:', error);
                    this.ui.showToast('åŒ¯å‡ºå¤±æ•—: ' + error.message, 'error');
                }
            }

            // åŒ¯å‡ºçµæœç‚º CSV
            exportResultAsCSV() {
                if (!this.state.currentResult) {
                    this.ui.showToast('æ²’æœ‰çµæœè³‡æ–™å¯åŒ¯å‡º', 'warning');
                    return;
                }

                try {
                    const csvData = this.convertResponseToCSV(this.state.currentResult);
                    const filename = `spiritual-survey-result-${Utils.formatDate(new Date(), 'YYYY-MM-DD-HHmmss')}.csv`;
                    Utils.downloadFile(csvData, filename, 'text/csv;charset=utf-8;');
                    this.ui.showToast('çµæœå·²åŒ¯å‡ºç‚º CSV', 'success');
                } catch (error) {
                    console.error('åŒ¯å‡º CSV å¤±æ•—:', error);
                    this.ui.showToast('åŒ¯å‡ºå¤±æ•—: ' + error.message, 'error');
                }
            }

            // è½‰æ›å›è¦†ç‚º CSV
            convertResponseToCSV(response) {
                const headers = [
                    'ID', 'ç‰ˆæœ¬ID', 'ä½œç­”æ™‚é–“', 'å§“å', 'ç”Ÿæ—¥', 'æ€§åˆ¥', 'åœ‹ç±', 'åŸå¸‚',
                    'è·æ¥­', 'æ•™è‚²ç¨‹åº¦', 'å©šå§»ç‹€æ³', 'å®—æ•™ä¿¡ä»°', 'å±…ä½ç‹€æ³', 'æª¢æ¸¬æ—¥æœŸ'
                ];
                
                // æ·»åŠ é¡Œç›®æ¨™é¡Œ
                response.answers.forEach((answer, index) => {
                    headers.push(`Q${index + 1}`);
                });
                
                // æ·»åŠ ç¶­åº¦åˆ†æ•¸
                Object.keys(response.aggregates.byDimension).forEach(dimension => {
                    headers.push(`${dimension}_å¹³å‡åˆ†`);
                });
                headers.push('ç¸½å¹³å‡åˆ†');
                
                // å»ºç«‹è³‡æ–™è¡Œ
                const row = [
                    response.id,
                    response.versionId,
                    response.createdAt,
                    response.demographics.name || '',
                    response.demographics.birth || '',
                    response.demographics.gender || '',
                    response.demographics.nationality || '',
                    response.demographics.city || '',
                    response.demographics.profession || '',
                    response.demographics.education || '',
                    response.demographics.marital || '',
                    response.demographics.religion || '',
                    response.demographics.living || '',
                    response.demographics.testDate || ''
                ];
                
                // æ·»åŠ ç­”æ¡ˆ
                response.answers.forEach(answer => {
                    row.push(answer.value);
                });
                
                // æ·»åŠ ç¶­åº¦åˆ†æ•¸
                Object.values(response.aggregates.byDimension).forEach(score => {
                    row.push(score.toFixed(2));
                });
                row.push(response.aggregates.overall.toFixed(2));
                
                // çµ„åˆ CSV
                return [headers, row]
                    .map(row => row.map(cell => `"${cell}"`).join(','))
                    .join('\n');
            }
        }

        // ===== æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ– =====
        
        let app;

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('DOM è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼');
                
                // å»ºç«‹æ‡‰ç”¨ç¨‹å¼å¯¦ä¾‹
                app = new SpiritualSurveyApp();
                
                // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
                await app.init();
                
                console.log('æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å®Œæˆ');
                
            } catch (error) {
                console.error('æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å¤±æ•—:', error);
                
                // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #fee2e2;
                    border: 1px solid #fecaca;
                    color: #991b1b;
                    padding: 2rem;
                    border-radius: 8px;
                    max-width: 400px;
                    text-align: center;
                    z-index: 10000;
                `;
                errorDiv.innerHTML = `
                    <h3>ç³»çµ±åˆå§‹åŒ–å¤±æ•—</h3>
                    <p style="margin: 1rem 0;">${error.message}</p>
                    <button onclick="location.reload()" style="padding: 0.5rem 1rem; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        é‡æ–°è¼‰å…¥
                    </button>
                `;
                document.body.appendChild(errorDiv);
            }
        });

        // å…¨åŸŸéŒ¯èª¤è™•ç†
        window.addEventListener('error', (event) => {
            console.error('å…¨åŸŸéŒ¯èª¤:', event.error);
            if (app && app.ui) {
                app.ui.showToast('ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error');
            }
        });

        // æœªè™•ç†çš„ Promise æ‹’çµ•
        window.addEventListener('unhandledrejection', (event) => {
            console.error('æœªè™•ç†çš„ Promise æ‹’çµ•:', event.reason);
            if (app && app.ui) {
                app.ui.showToast('ç³»çµ±ç™¼ç”Ÿç•°æ­¥éŒ¯èª¤', 'error');
            }
        });

        // åŒ¯å‡ºåˆ°å…¨åŸŸï¼ˆç”¨æ–¼èª¿è©¦ï¼‰
        window.SpiritualSurveyApp = SpiritualSurveyApp;
        window.Utils = Utils;
        window.CONFIG = CONFIG;
    </script>


<div id="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 2000; pointer-events: none;"></div></body></html>
